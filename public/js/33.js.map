{"version":3,"sources":["webpack:///./resources/js/components/forms/UserForm.vue?0ca9","webpack:///./resources/js/components/forms/UserForm.vue?4861","webpack:///resources/js/components/forms/UserForm.vue","webpack:///./resources/js/components/forms/UserForm.vue"],"names":["name","props","action","String","method","type","default","roles","Array","user","Object","first_name","last_name","institution","curated_taxa","redirect","data","filteredTaxa","curatedTaxa","this","form","roles_ids","map","curated_taxa_ids","resetOnSuccess","computed","isCurator","watch","value","methods","onTaxonNameInput","fetchTaxa","axios","get","route","params","page","per_page","except","submit","processing","toLowerCase","onSuccessfulSubmit","$buefy","toast","open","setTimeout","onFailedSubmit","duration","message","component","_vm","_h","$createElement","_c","_self","staticClass","on","$event","preventDefault","attrs","trans","model","callback","$$v","$set","expression","_v","_l","role","key","id","_s","scopedSlots","_u","fn","option","_e"],"mappings":"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","file":"js/33.js?id=18691e0447846276629c","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"user-form\"},[_c('form',{on:{\"submit\":function($event){$event.preventDefault();return _vm.submit($event)}}},[_c('div',{staticClass:\"columns\"},[_c('div',{staticClass:\"column\"},[_c('b-field',{staticClass:\"is-required\",attrs:{\"label\":_vm.trans('labels.users.first_name')}},[_c('b-input',{model:{value:(_vm.form.first_name),callback:function ($$v) {_vm.$set(_vm.form, \"first_name\", $$v)},expression:\"form.first_name\"}})],1)],1),_vm._v(\" \"),_c('div',{staticClass:\"column\"},[_c('b-field',{staticClass:\"is-required\",attrs:{\"label\":_vm.trans('labels.users.last_name')}},[_c('b-input',{model:{value:(_vm.form.last_name),callback:function ($$v) {_vm.$set(_vm.form, \"last_name\", $$v)},expression:\"form.last_name\"}})],1)],1)]),_vm._v(\" \"),_c('b-field',{attrs:{\"label\":_vm.trans('labels.users.institution')}},[_c('b-input',{model:{value:(_vm.form.institution),callback:function ($$v) {_vm.$set(_vm.form, \"institution\", $$v)},expression:\"form.institution\"}})],1),_vm._v(\" \"),_c('b-field',{attrs:{\"label\":_vm.trans('labels.users.roles')}},[_c('div',{staticClass:\"block\"},_vm._l((_vm.roles),function(role){return _c('b-checkbox',{key:role.id,attrs:{\"native-value\":role.id},model:{value:(_vm.form.roles_ids),callback:function ($$v) {_vm.$set(_vm.form, \"roles_ids\", $$v)},expression:\"form.roles_ids\"}},[_vm._v(\"\\n          \"+_vm._s(_vm.trans('roles.' + role.name))+\"\\n        \")])}),1)]),_vm._v(\" \"),(_vm.isCurator)?_c('b-field',{attrs:{\"label\":_vm.trans('labels.users.curated_taxa')}},[_c('b-taginput',{attrs:{\"data\":_vm.filteredTaxa,\"autocomplete\":\"\",\"field\":\"name\",\"placeholder\":\"Type taxon name\"},on:{\"typing\":_vm.onTaxonNameInput},scopedSlots:_vm._u([{key:\"default\",fn:function(props){return [_c('span',[_vm._v(_vm._s(props.option.name))])]}}],null,false,1538493864),model:{value:(_vm.curatedTaxa),callback:function ($$v) {_vm.curatedTaxa=$$v},expression:\"curatedTaxa\"}})],1):_vm._e(),_vm._v(\" \"),_c('hr'),_vm._v(\" \"),_c('button',{staticClass:\"button is-primary\",attrs:{\"type\":\"submit\"}},[_vm._v(_vm._s(_vm.trans('buttons.save')))])],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../../../node_modules/babel-loader/lib/index.js??ref--4-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UserForm.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/babel-loader/lib/index.js??ref--4-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UserForm.vue?vue&type=script&lang=js&\"","<template>\n  <div class=\"user-form\">\n    <form @submit.prevent=\"submit\">\n      <div class=\"columns\">\n        <div class=\"column\">\n          <b-field :label=\"trans('labels.users.first_name')\" class=\"is-required\">\n            <b-input v-model=\"form.first_name\" />\n          </b-field>\n        </div>\n\n        <div class=\"column\">\n          <b-field :label=\"trans('labels.users.last_name')\" class=\"is-required\">\n            <b-input v-model=\"form.last_name\" />\n          </b-field>\n        </div>\n      </div>\n\n      <b-field :label=\"trans('labels.users.institution')\">\n        <b-input v-model=\"form.institution\" />\n      </b-field>\n\n      <b-field :label=\"trans('labels.users.roles')\">\n        <div class=\"block\">\n          <b-checkbox\n            v-for=\"role in roles\"\n            :key=\"role.id\"\n            v-model=\"form.roles_ids\"\n            :native-value=\"role.id\"\n          >\n            {{ trans('roles.' + role.name) }}\n          </b-checkbox>\n        </div>\n      </b-field>\n\n      <b-field :label=\"trans('labels.users.curated_taxa')\" v-if=\"isCurator\">\n        <b-taginput\n          v-model=\"curatedTaxa\"\n          :data=\"filteredTaxa\"\n          autocomplete\n          field=\"name\"\n          placeholder=\"Type taxon name\"\n          @typing=\"onTaxonNameInput\"\n        >\n          <template v-slot:default=\"props\">\n            <span>{{ props.option.name }}</span>\n          </template>\n        </b-taginput>\n      </b-field>\n\n      <hr>\n\n      <button type=\"submit\" class=\"button is-primary\">{{ trans('buttons.save') }}</button>\n    </form>\n  </div>\n</template>\n\n<script>\nimport Form from 'form-backend-validation'\nimport _find from 'lodash/find'\nimport _includes from 'lodash/includes'\nimport _get from 'lodash/get'\nimport _debounce from 'lodash/debounce'\n\nexport default {\n  name: 'nzUserForm',\n\n  props: {\n    action: String,\n    method: {\n      type: String,\n      default: 'post'\n    },\n    roles: Array,\n    user: {\n      type: Object,\n      default() {\n        return {\n          first_name: '',\n          last_name: '',\n          institution: '',\n          roles: [],\n          curated_taxa: [],\n        }\n      }\n    },\n    redirect: String\n  },\n\n  data() {\n    return {\n      filteredTaxa: [],\n      curatedTaxa: this.user.curated_taxa,\n      form: new Form({\n        first_name: this.user.first_name,\n        last_name: this.user.last_name,\n        institution: this.user.institution,\n        roles_ids: this.user.roles.map(role => role.id),\n        curated_taxa_ids: this.user.curated_taxa.map(taxon => taxon.id)\n      }, {\n        resetOnSuccess: false\n      })\n    }\n  },\n\n  computed: {\n    isCurator() {\n      return _includes(this.form.roles_ids, _find(this.roles, { name: 'curator' }).id)\n    }\n  },\n\n  watch: {\n    curatedTaxa(value) {\n      this.form.curated_taxa_ids = value.map(taxon => taxon.id)\n    }\n  },\n\n  methods: {\n    onTaxonNameInput: _debounce(function (name) {\n      return this.fetchTaxa(name)\n    }, 500),\n\n    fetchTaxa(name) {\n      axios.get(route('api.taxa.index'), {\n        params: {\n          name,\n          page: 1,\n          per_page: 10,\n          except: this.curatedTaxa.map(taxon => taxon.id)\n        }\n      }).then(({ data }) => {\n        this.filteredTaxa = data.data\n      })\n    },\n\n    submit() {\n      if (this.form.processing) return\n\n      this.form[this.method.toLowerCase()](this.action)\n          .then(this.onSuccessfulSubmit)\n          .catch(this.onFailedSubmit)\n    },\n\n    /**\n     * Handle successful form submit.\n     */\n    onSuccessfulSubmit() {\n      this.form.processing = true\n\n      this.$buefy.toast.open({\n          message: this.trans('Saved successfully'),\n          type: 'is-success'\n      })\n\n      // We want to wait a bit before we send the user to redirect route\n      // so we can show the message that the action was successful.\n      setTimeout(() => {\n          this.form.processing = false\n\n          window.location.href = this.redirect\n      }, 500)\n    },\n\n    /**\n     * Handle failed form submit.\n     *\n     * @param {Error} error\n     */\n    onFailedSubmit(error) {\n      this.$buefy.toast.open({\n        duration: 2500,\n        message: _get(error, 'response.data.message', error.message),\n        type: 'is-danger'\n      })\n    }\n  }\n}\n</script>\n","import { render, staticRenderFns } from \"./UserForm.vue?vue&type=template&id=1a699d11&\"\nimport script from \"./UserForm.vue?vue&type=script&lang=js&\"\nexport * from \"./UserForm.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}