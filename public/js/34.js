(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{Fr13:function(t,e,a){"use strict";a.r(e);var n=a("3wZJ"),o=a("9KKN"),s=a("2qhe"),r=a("uuKk"),i=a("luGL"),l=a("DgLj");function c(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function d(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function u(t,e){if(null==t)return{};var a,n,o=function(t,e){if(null==t)return{};var a,n,o={},s=Object.keys(t);for(n=0;n<s.length;n++)a=s[n],e.indexOf(a)>=0||(o[a]=t[a]);return o}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(n=0;n<s.length;n++)a=s[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(o[a]=t[a])}return o}var p={name:"nzTaxaTable",mixins:[n.a,o.a],components:{NzTaxonAutocomplete:r.a,NzTable:i.a,NzExportModal:l.a},props:{perPageOptions:{type:Array,default:function(){return[15,30,50,100]},validator:function(t){return t.length}},listRoute:String,editRoute:String,deleteRoute:String,empty:{type:String,default:"Nothing here."},ranks:Array,showActivityLog:Boolean,exportColumns:Array,exportUrl:String},data:function(){return{data:[],total:0,loading:!1,sortField:"id",sortOrder:"desc",defaultSortOrder:"asc",page:1,perPage:this.perPageOptions[0],checkedRows:[],activityLog:[],showExportModal:!1}},computed:{hasActions:function(){return this.exportable},exportable:function(){return!(!this.exportUrl||!this.exportColumns.length)},checkedIds:function(){return this.checkedRows.map((function(t){return t.id}))},sortBy:function(){return"".concat(this.sortField,".").concat(this.sortOrder)}},created:function(){var t=this;this.restoreState(),this.addMissingValuesAfterRestoration(),this.loadAsyncData(),this.$on("filter",(function(){t.saveState(),t.loadAsyncData()}))},methods:{loadAsyncData:function(){var t=this;this.loading=!0;var e=this.filter,a=(e.selectedTaxon,u(e,["selectedTaxon"]));return axios.get(route(this.listRoute).withQuery(function(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?c(Object(a),!0).forEach((function(e){d(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}({},a,{sort_by:this.sortBy,page:this.page,per_page:this.perPage}))).then((function(e){var a=e.data;t.data=a.data,t.total=a.meta.total,t.loading=!1}),(function(e){t.data=[],t.total=0,t.loading=!1}))},onPageChange:function(t){this.page=t,this.saveState(),this.loadAsyncData()},onSort:function(t,e){this.sortField=t,this.sortOrder=e,this.saveState(),this.loadAsyncData()},onPerPageChange:function(t){t!==this.perPage&&(this.perPage=t,this.saveState(),this.loadAsyncData())},confirmRemove:function(t){var e=this;this.$buefy.dialog.confirm({message:this.trans("Are you sure you want to delete this record?"),confirmText:this.trans("buttons.delete"),cancelText:this.trans("buttons.cancel"),type:"is-danger",onConfirm:function(){e.remove(t)}})},remove:function(t){var e=this;return axios.delete(route(this.deleteRoute,t.id)).then((function(t){e.$buefy.toast.open({message:e.trans("Record deleted"),type:"is-success"}),e.loadAsyncData()})).catch((function(t){console.error(t)}))},editLink:function(t){return route(this.editRoute,t.id)},openActivityLogModal:function(t){this.activityLog=t.activity},filterDefaults:function(){return{name:null,rank:null,taxonId:null,includeChildTaxa:null,selectedTaxon:null,id:null}},openExportModal:function(){this.showExportModal=!0},onExportDone:function(t){this.showExportModal=!1,t.url?this.$buefy.modal.open({parent:this,component:s.a,canCancel:[],hasModalCard:!0,props:{url:t.url}}):this.$buefy.toast.open({duration:0,message:"Something's not good, also I'm on bottom",type:"is-danger"})},onTaxonSelect:function(t){this.newFilter.taxonId=t?t.id:null,this.newFilter.selectedTaxon=t},getPersistantKeys:function(){return["sortField","sortOrder","perPage","page","newFilter","filter","filterIsActive"]},addMissingValuesAfterRestoration:function(){this.page=this.page||1,this.perPage=this.perPage||this.perPageOptions[0],this.sortField=this.sortField||"id",this.sortOrder=this.sortOrder||"desc"}}},h=a("KHd+"),f=Object(h.a)(p,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"taxa-table"},[a("div",{staticClass:"level"},[a("div",{staticClass:"level-left"},[a("div",{staticClass:"level-item"},[a("button",{staticClass:"button is-touch-full",attrs:{type:"button"},on:{click:function(e){t.showFilter=!t.showFilter}}},[a("b-icon",{class:[t.filterIsActive?"has-text-primary":"has-text-grey-light"],attrs:{icon:"filter"}}),t._v(" "),a("span",[t._v(t._s(t.trans("buttons.filters")))])],1)])]),t._v(" "),t.hasActions?a("div",{staticClass:"level-right"},[a("div",{staticClass:"level-item"},[a("b-dropdown",{attrs:{position:"is-bottom-left"}},[a("button",{staticClass:"button is-touch-full",attrs:{slot:"trigger"},slot:"trigger"},[a("span",[t._v(t._s(t.trans("labels.actions")))]),t._v(" "),a("span",{staticClass:"icon has-text-grey"},[a("i",{staticClass:"fa fa-angle-down"})])]),t._v(" "),t.exportable?a("b-dropdown-item",{on:{click:t.openExportModal}},[a("b-icon",{staticClass:"has-text-grey",attrs:{icon:"download"}}),t._v(" "),a("span",[t._v(t._s(t.trans("buttons.export")))])],1):t._e()],1)],1)]):t._e()]),t._v(" "),a("b-collapse",{staticClass:"mt-4",attrs:{open:t.showFilter}},[a("form",{on:{submit:function(e){return e.preventDefault(),t.applyFilter(e)}}},[a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column is-half",attrs:{label:t.trans("labels.taxa.rank")}},[a("b-select",{attrs:{expanded:""},model:{value:t.newFilter.rank,callback:function(e){t.$set(t.newFilter,"rank",e)},expression:"newFilter.rank"}},[a("option",{attrs:{value:""}}),t._v(" "),t._l(t.ranks,(function(e,n){return a("option",{key:n,domProps:{value:e.value,textContent:t._s(e.label)}})}))],2)],1),t._v(" "),a("div",{staticClass:"column is half"},[a("nz-taxon-autocomplete",{attrs:{taxon:t.newFilter.selectedTaxon,label:t.trans("labels.taxa.name"),placeholder:""},on:{select:t.onTaxonSelect},model:{value:t.newFilter.name,callback:function(e){t.$set(t.newFilter,"name",e)},expression:"newFilter.name"}}),t._v(" "),a("b-checkbox",{model:{value:t.newFilter.includeChildTaxa,callback:function(e){t.$set(t.newFilter,"includeChildTaxa",e)},expression:"newFilter.includeChildTaxa"}},[t._v(t._s(t.trans("labels.taxa.include_lower_taxa")))])],1)],1),t._v(" "),a("button",{staticClass:"button is-primary is-outlined",attrs:{type:"submit"},on:{click:t.applyFilter}},[t._v(t._s(t.trans("buttons.apply")))]),t._v(" "),a("button",{staticClass:"button",attrs:{type:"button"},on:{click:t.clearFilter}},[t._v(t._s(t.trans("buttons.clear")))])])]),t._v(" "),a("hr"),t._v(" "),a("nz-table",{attrs:{data:t.data,loading:t.loading,paginated:"","backend-pagination":"",total:t.total,"per-page":t.perPage,"per-page-options":t.perPageOptions,"pagination-on-top":"","backend-sorting":"","default-sort-direction":t.defaultSortOrder,"default-sort":[t.sortField,t.sortOrder],"mobile-cards":!0,checkable:t.hasActions,"checked-rows":t.checkedRows},on:{"page-change":t.onPageChange,"per-page-change":t.onPerPageChange,sort:t.onSort,"update:checkedRows":function(e){t.checkedRows=e},"update:checked-rows":function(e){t.checkedRows=e}},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("b-table-column",{attrs:{field:"id",label:t.trans("labels.id"),width:"40",numeric:"",sortable:""}},[t._v("\n        "+t._s(n.id)+"\n      ")]),t._v(" "),a("b-table-column",{attrs:{field:"rank_level",label:t.trans("labels.taxa.rank"),sortable:""}},[t._v("\n        "+t._s(n.rank_translation)+"\n      ")]),t._v(" "),a("b-table-column",{attrs:{field:"name",label:t.trans("labels.taxa.name"),sortable:""}},[t._v("\n        "+t._s(n.name+(n.native_name?" ("+n.native_name+")":""))+"\n      ")]),t._v(" "),a("b-table-column",{attrs:{width:"150",numeric:""}},[t.showActivityLog&&n.activity&&n.activity.length>0?a("a",{attrs:{title:t.trans("Activity Log")},on:{click:function(e){return t.openActivityLogModal(n)}}},[a("b-icon",{attrs:{icon:"history"}})],1):t._e(),t._v(" "),n.can_edit?a("a",{attrs:{href:t.editLink(n)}},[a("b-icon",{attrs:{icon:"edit"}})],1):t._e(),t._v(" "),n.can_delete?a("a",{on:{click:function(e){return t.confirmRemove(n)}}},[a("b-icon",{attrs:{icon:"trash"}})],1):t._e()])]}}])},[t._v(" "),a("template",{slot:"empty"},[a("section",{staticClass:"section"},[a("div",{staticClass:"content has-text-grey has-text-centered"},[a("p",[t._v(t._s(t.empty))])])])])],2),t._v(" "),a("b-modal",{attrs:{active:t.activityLog.length>0,"has-modal-card":""},on:{close:function(e){t.activityLog=[]}}},[a("div",{staticClass:"modal-card"},[a("div",{staticClass:"modal-card-head"},[a("b-icon",{attrs:{icon:"history"}}),t._v(" "),a("p",{staticClass:"modal-card-title"},[t._v(t._s(t.trans("Activity Log")))])],1),t._v(" "),a("div",{staticClass:"modal-card-body"},[a("nz-taxon-activity-log",{attrs:{activities:t.activityLog}})],1)])]),t._v(" "),a("b-modal",{attrs:{active:t.showExportModal,"has-modal-card":"","can-cancel":[]},on:{close:function(e){t.showExportModal=!1}}},[a("nz-export-modal",{attrs:{checked:t.checkedIds,filter:t.filter,columns:t.exportColumns,url:t.exportUrl,types:["custom"],sort:t.sortBy},on:{cancel:function(e){t.showExportModal=!1},done:t.onExportDone}})],1)],1)}),[],!1,null,null,null);e.default=f.exports}}]);
//# sourceMappingURL=34.js.map?id=9c6e689968d9891806ac