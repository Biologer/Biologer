(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{Fr13:function(t,e,n){"use strict";n.r(e);var a=n("3wZJ"),o=n("9KKN"),i=n("2qhe"),s=n("uuKk"),r=n("luGL"),l=n("DgLj");function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,a)}return n}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function d(t,e){if(null==t)return{};var n,a,o=function(t,e){if(null==t)return{};var n,a,o={},i=Object.keys(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}var p={name:"nzTaxaTable",mixins:[a.a,o.a],components:{NzTaxonAutocomplete:s.a,NzTable:r.a,NzExportModal:l.a},props:{perPageOptions:{type:Array,default:function(){return[15,30,50,100]},validator:function(t){return t.length}},listRoute:String,editRoute:String,deleteRoute:String,empty:{type:String,default:"Nothing here."},ranks:Array,showActivityLog:Boolean,exportColumns:Array,exportUrl:String},data:function(){return{data:[],total:0,loading:!1,sortField:"id",sortOrder:"desc",defaultSortOrder:"asc",page:1,perPage:this.perPageOptions[0],checkedRows:[],activityLog:[],showExportModal:!1}},computed:{hasActions:function(){return this.exportable},exportable:function(){return!(!this.exportUrl||!this.exportColumns.length)},checkedIds:function(){return this.checkedRows.map(function(t){return t.id})},sortBy:function(){return"".concat(this.sortField,".").concat(this.sortOrder)}},created:function(){var t=this;this.restoreState(),this.addMissingValuesAfterRestoration(),this.loadAsyncData(),this.$on("filter",function(){t.saveState(),t.loadAsyncData()})},methods:{loadAsyncData:function(){var t=this;this.loading=!0;var e=this.filter,n=(e.selectedTaxon,d(e,["selectedTaxon"]));return axios.get(route(this.listRoute).withQuery(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(n,!0).forEach(function(e){u(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({},n,{sort_by:this.sortBy,page:this.page,per_page:this.perPage}))).then(function(e){var n=e.data;t.data=n.data,t.total=n.meta.total,t.loading=!1},function(e){t.data=[],t.total=0,t.loading=!1})},onPageChange:function(t){this.page=t,this.saveState(),this.loadAsyncData()},onSort:function(t,e){this.sortField=t,this.sortOrder=e,this.saveState(),this.loadAsyncData()},onPerPageChange:function(t){t!==this.perPage&&(this.perPage=t,this.saveState(),this.loadAsyncData())},confirmRemove:function(t){var e=this;this.$buefy.dialog.confirm({message:this.trans("Are you sure you want to delete this record?"),confirmText:this.trans("buttons.delete"),cancelText:this.trans("buttons.cancel"),type:"is-danger",onConfirm:function(){e.remove(t)}})},remove:function(t){var e=this;return axios.delete(route(this.deleteRoute,t.id)).then(function(t){e.$buefy.toast.open({message:e.trans("Record deleted"),type:"is-success"}),e.loadAsyncData()}).catch(function(t){console.error(t)})},editLink:function(t){return route(this.editRoute,t.id)},openActivityLogModal:function(t){this.activityLog=t.activity},filterDefaults:function(){return{name:null,rank:null,taxonId:null,includeChildTaxa:null,selectedTaxon:null,id:null}},openExportModal:function(){this.showExportModal=!0},onExportDone:function(t){this.showExportModal=!1,t.url?this.$buefy.modal.open({parent:this,component:i.a,canCancel:[],hasModalCard:!0,props:{url:t.url}}):this.$buefy.toast.open({duration:0,message:"Something's not good, also I'm on bottom",type:"is-danger"})},onTaxonSelect:function(t){this.newFilter.taxonId=t?t.id:null,this.newFilter.selectedTaxon=t},getPersistantKeys:function(){return["sortField","sortOrder","perPage","page","newFilter","filter","filterIsActive"]},addMissingValuesAfterRestoration:function(){this.page=this.page||1,this.perPage=this.perPage||this.perPageOptions[0],this.sortField=this.sortField||"id",this.sortOrder=this.sortOrder||"desc"}}},h=n("KHd+"),f=Object(h.a)(p,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"taxa-table"},[n("div",{staticClass:"level"},[n("div",{staticClass:"level-left"},[n("div",{staticClass:"level-item"},[n("button",{staticClass:"button is-touch-full",attrs:{type:"button"},on:{click:function(e){t.showFilter=!t.showFilter}}},[n("b-icon",{class:[t.filterIsActive?"has-text-primary":"has-text-grey-light"],attrs:{icon:"filter"}}),t._v(" "),n("span",[t._v(t._s(t.trans("buttons.filters")))])],1)])]),t._v(" "),t.hasActions?n("div",{staticClass:"level-right"},[n("div",{staticClass:"level-item"},[n("b-dropdown",{attrs:{position:"is-bottom-left"}},[n("button",{staticClass:"button is-touch-full",attrs:{slot:"trigger"},slot:"trigger"},[n("span",[t._v(t._s(t.trans("labels.actions")))]),t._v(" "),n("span",{staticClass:"icon has-text-grey"},[n("i",{staticClass:"fa fa-angle-down"})])]),t._v(" "),t.exportable?n("b-dropdown-item",{on:{click:t.openExportModal}},[n("b-icon",{staticClass:"has-text-grey",attrs:{icon:"download"}}),t._v(" "),n("span",[t._v(t._s(t.trans("buttons.export")))])],1):t._e()],1)],1)]):t._e()]),t._v(" "),n("b-collapse",{staticClass:"mt-4",attrs:{open:t.showFilter}},[n("form",{on:{submit:function(e){return e.preventDefault(),t.applyFilter(e)}}},[n("div",{staticClass:"columns"},[n("b-field",{staticClass:"column is-half",attrs:{label:t.trans("labels.taxa.rank")}},[n("b-select",{attrs:{expanded:""},model:{value:t.newFilter.rank,callback:function(e){t.$set(t.newFilter,"rank",e)},expression:"newFilter.rank"}},[n("option",{attrs:{value:""}}),t._v(" "),t._l(t.ranks,function(e,a){return n("option",{key:a,domProps:{value:e.value,textContent:t._s(e.label)}})})],2)],1),t._v(" "),n("div",{staticClass:"column is half"},[n("nz-taxon-autocomplete",{attrs:{taxon:t.newFilter.selectedTaxon,label:t.trans("labels.taxa.name"),placeholder:""},on:{select:t.onTaxonSelect},model:{value:t.newFilter.name,callback:function(e){t.$set(t.newFilter,"name",e)},expression:"newFilter.name"}}),t._v(" "),n("b-checkbox",{model:{value:t.newFilter.includeChildTaxa,callback:function(e){t.$set(t.newFilter,"includeChildTaxa",e)},expression:"newFilter.includeChildTaxa"}},[t._v(t._s(t.trans("labels.taxa.include_lower_taxa")))])],1)],1),t._v(" "),n("button",{staticClass:"button is-primary is-outlined",attrs:{type:"submit"},on:{click:t.applyFilter}},[t._v(t._s(t.trans("buttons.apply")))]),t._v(" "),n("button",{staticClass:"button",attrs:{type:"button"},on:{click:t.clearFilter}},[t._v(t._s(t.trans("buttons.clear")))])])]),t._v(" "),n("hr"),t._v(" "),n("nz-table",{attrs:{data:t.data,loading:t.loading,paginated:"","backend-pagination":"",total:t.total,"per-page":t.perPage,"per-page-options":t.perPageOptions,"pagination-on-top":"","backend-sorting":"","default-sort-direction":t.defaultSortOrder,"default-sort":[t.sortField,t.sortOrder],"mobile-cards":!0,checkable:t.hasActions,"checked-rows":t.checkedRows},on:{"page-change":t.onPageChange,"per-page-change":t.onPerPageChange,sort:t.onSort,"update:checkedRows":function(e){t.checkedRows=e},"update:checked-rows":function(e){t.checkedRows=e}},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[n("b-table-column",{attrs:{field:"id",label:t.trans("labels.id"),width:"40",numeric:"",sortable:""}},[t._v("\n        "+t._s(a.id)+"\n      ")]),t._v(" "),n("b-table-column",{attrs:{field:"rank_level",label:t.trans("labels.taxa.rank"),sortable:""}},[t._v("\n        "+t._s(a.rank_translation)+"\n      ")]),t._v(" "),n("b-table-column",{attrs:{field:"name",label:t.trans("labels.taxa.name"),sortable:""}},[t._v("\n        "+t._s(a.name+(a.native_name?" ("+a.native_name+")":""))+"\n      ")]),t._v(" "),n("b-table-column",{attrs:{width:"150",numeric:""}},[t.showActivityLog&&a.activity&&a.activity.length>0?n("a",{attrs:{title:t.trans("Activity Log")},on:{click:function(e){return t.openActivityLogModal(a)}}},[n("b-icon",{attrs:{icon:"history"}})],1):t._e(),t._v(" "),a.can_edit?n("a",{attrs:{href:t.editLink(a)}},[n("b-icon",{attrs:{icon:"edit"}})],1):t._e(),t._v(" "),a.can_delete?n("a",{on:{click:function(e){return t.confirmRemove(a)}}},[n("b-icon",{attrs:{icon:"trash"}})],1):t._e()])]}}])},[t._v(" "),n("template",{slot:"empty"},[n("section",{staticClass:"section"},[n("div",{staticClass:"content has-text-grey has-text-centered"},[n("p",[t._v(t._s(t.empty))])])])])],2),t._v(" "),n("b-modal",{attrs:{active:t.activityLog.length>0},on:{close:function(e){t.activityLog=[]}}},[n("div",{staticClass:"modal-card"},[n("div",{staticClass:"modal-card-head"},[n("b-icon",{attrs:{icon:"history"}}),t._v(" "),n("p",{staticClass:"modal-card-title"},[t._v(t._s(t.trans("Activity Log")))])],1),t._v(" "),n("div",{staticClass:"modal-card-body"},[n("nz-taxon-activity-log",{attrs:{activities:t.activityLog}})],1)])]),t._v(" "),n("b-modal",{attrs:{active:t.showExportModal,"has-modal-card":"","can-cancel":[]},on:{close:function(e){t.showExportModal=!1}}},[n("nz-export-modal",{attrs:{checked:t.checkedIds,filter:t.filter,columns:t.exportColumns,url:t.exportUrl,types:["custom"],sort:t.sortBy},on:{cancel:function(e){t.showExportModal=!1},done:t.onExportDone}})],1)],1)},[],!1,null,null,null);e.default=f.exports},uuKk:function(t,e,n){"use strict";var a=n("vDqi"),o=n.n(a),i=n("sEfC"),s=n.n(i),r=n("mwIZ"),l=n.n(r);function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var u={name:"nzTaxonAutocomplete",props:{label:{type:String,default:"Taxon"},placeholder:{type:String,default:"Search for taxon..."},taxon:{type:Object,default:null},url:{type:String,default:function(){return route("api.taxa.index")}},value:{type:String,default:""},error:Boolean,message:{type:String,default:null},except:{},autofocus:Boolean},data:function(){return{data:[],selected:this.taxon||null,loading:!1}},computed:{haveThumbnail:function(){return this.selected&&this.selected.thumbnail_url},icon:function(){return this.selected?"check":"search"}},watch:{taxon:function(t){this.selected=t}},methods:{fetchData:s()(function(){var t=this;if(this.value){this.data=[],this.loading=!0;var e={name:this.value,limit:20};this.except&&(e.except=this.except),o.a.get(this.url,{params:e}).then(function(e){e.data.data.forEach(function(e){return t.data.push(e)}),t.loading=!1},function(e){t.loading=!1})}},500),onSelect:function(t){this.selected=t,this.$emit("select",t)},onInput:function(t){var e=this.getValue(this.selected);e&&e!==t&&this.onSelect(null),this.$emit("input",t),this.fetchData()},focusOnInput:function(){this.$el.querySelector("input").focus()},getValue:function(t){if(t)return"object"===c(t)?l()(t,"name"):t},enterPressed:function(){this.$refs.autocomplete.isActive||this.$emit("enter")}}},d=n("KHd+"),p=Object(d.a)(u,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-field",{staticClass:"nz-taxon-autocomplete",attrs:{label:t.label,type:t.error?"is-danger":null,message:t.message}},[n("b-field",{attrs:{grouped:""}},[t.haveThumbnail?n("img",{attrs:{width:"32",src:this.selected.thumbnail_url}}):t._e(),t._v(" "),n("b-autocomplete",{ref:"autocomplete",attrs:{value:t.value,data:t.data,field:"name",loading:t.loading,icon:t.icon,placeholder:t.placeholder,expanded:"",autofocus:t.autofocus},on:{input:t.onInput,select:t.onSelect},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.enterPressed(e)}},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{staticClass:"media"},[n("div",{staticClass:"media-left"},[e.option.thumbnail_url?n("img",{attrs:{width:"32",src:e.option.thumbnail_url}}):t._e()]),t._v(" "),n("div",{staticClass:"media-content"},[t._v("\n            "+t._s(e.option.name)+t._s(e.option.native_name?" ("+e.option.native_name+")":"")+"\n          ")])])]}}])})],1)],1)},[],!1,null,null,null);e.a=p.exports}}]);
//# sourceMappingURL=28.js.map?id=b0d17d6152c0e5d241ff