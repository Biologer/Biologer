(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"1+5i":function(t,e,o){var r=o("w/wX"),n=o("sEf8"),a=o("mdPL"),i=a&&a.isSet,s=i?n(i):r;t.exports=s},"8dal":function(t,e,o){"use strict";o.r(e);var r=o("5YJQ"),n=o.n(r),a=o("JkKK"),i=o("BkRI"),s=o.n(i),l=o("mwIZ"),c=o.n(l),u=o("J2m7"),m=o.n(u),f=o("UfWW"),d=o.n(f),p=o("JZM8"),b=o.n(p),h=o("wEy/"),v=o.n(h),_=o("mk2N"),g=o("pY92"),y=o("KUSn"),x=o("nWYc"),C=o("l90O"),w=o("vDqi"),j=o.n(w),S=o("sEfC");function k(t){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var O={name:"nzCollectionAutocomplete",props:{label:{type:String,default:"Collection"},placeholder:{type:String,default:"Search for collection..."},collection:{type:Object,default:null},route:{type:String,default:"api.autocomplete.specimen-collections.index"},value:{type:String,default:""},error:Boolean,message:{type:String,default:null},except:{},autofocus:Boolean,disabled:Boolean},data:function(){return{data:[],selected:this.collection||null,loading:!1}},computed:{icon:function(){return this.selected?"check":"search"}},watch:{publication:function(t){this.selected=t}},methods:{fetchData:o.n(S)()((function(){var t=this;if(this.value){this.data=[],this.loading=!0;var e={name:this.value};this.except&&(e.except=this.except),j.a.get(route(this.route),{params:e}).then((function(e){e.data.data.forEach((function(e){return t.data.push(e)})),t.loading=!1}),(function(e){t.loading=!1}))}}),500),onSelect:function(t){this.selected=t,this.$emit("select",t)},onInput:function(t){var e=this.getValue(this.selected);e&&e!==t&&this.onSelect(null),this.$emit("input",t),this.fetchData()},focusOnInput:function(){this.$el.querySelector("input").focus()},getValue:function(t){if(t)return"object"===k(t)?c()(t,"name"):t}}},P=o("KHd+"),E=Object(P.a)(O,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("b-field",{staticClass:"nz-collection-autocomplete",attrs:{label:t.label,type:t.error?"is-danger":null,message:t.message}},[o("b-field",{attrs:{grouped:""}},[o("b-autocomplete",{attrs:{value:t.value,data:t.data,field:"name",loading:t.loading,icon:t.icon,placeholder:t.placeholder,expanded:"",autofocus:t.autofocus,disabled:t.disabled},on:{input:t.onInput,select:t.onSelect},scopedSlots:t._u([{key:"default",fn:function(e){return[o("div",{staticClass:"media"},[o("div",{staticClass:"media-content"},[t._v("\n            "+t._s(e.option.name)+" ("+t._s(e.option.code)+")\n          ")])])]}}])}),t._v(" "),t._t("default")],2)],1)}),[],!1,null,null,null).exports,A=o("uuKk");function $(t){return function(t){if(Array.isArray(t))return I(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return I(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return I(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,r=new Array(e);o<e;o++)r[o]=t[o];return r}function T(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,r)}return o}function D(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?T(Object(o),!0).forEach((function(e){M(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):T(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function M(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var R={name:"nzCollectionObservationForm",mixins:[g.a,_.a],components:{NzDateInput:y.a,NzPhotoUpload:x.a,NzSpatialInput:C.a,NzCollectionAutocomplete:E,NzTaxonAutocomplete:A.a},props:{submitMoreWithSameTaxon:Boolean,observation:{type:Object,default:function(){return{original_date:null,original_locality:null,original_elevation:null,original_coordinates:null,original_identification:null,original_identification_validity:null,verbatim_tag:null,collecting_start_year:null,collecting_start_month:null,collecting_end_year:null,collecting_end_month:null,collecting_method:null,collector:null,collection_id:null,catalogue_number:null,cabinet_number:null,box_number:null,disposition:null,type_status:null,preparator:null,preparation_method:null,taxon_id:null,year:Object(a.a)().year(),month:Object(a.a)().month()+1,day:Object(a.a)().date(),latitude:null,longitude:null,location:null,accuracy:null,elevation:null,minimum_elevation:null,maximum_elevation:null,georeferenced_by:null,georeferenced_date:null,observer:null,identifier:null,note:null,sex:null,number:null,project:null,found_on:null,habitat:null,stage_id:null,time:null,dataset:null,taxon:null,collection:null,photos:[]}}},licenses:{type:Object,default:function(){return{}}},sexes:{type:Object,default:function(){return{}}},dispositions:{type:Object,default:function(){return{}}},validityOptions:{type:[Array,Object],default:function(){return[]}}},data:function(){return{keepAfterSubmit:this.getAttributesToKeep(),submittingWithoutRedirectWithSameTaxon:!1,locale:window.App.locale,taxonName:c()(this.observation,"taxon.name",""),collectionName:c()(this.observation,"collection.name","")}},computed:{stages:function(){return this.form.taxon?this.form.taxon.stages:[]},time:function(){return this.form.time?Object(a.a)(this.form.time,"HH:mm").toDate():null},georeferencedDate:{get:function(){var t=Object(a.a)(this.form.georeferenced_date);return t.isValid()?t.toDate():null},set:function(t){this.form.georeferenced_date=Object(a.a)(t).format("YYYY-MM-DD")}},months:function(){return a.a.months()}},created:function(){this.restoreState()},methods:{otherPersistentKeys:function(){return["taxonName","collectionName"]},newForm:function(){return new n.a(D(D({},this.observation),{},{reason:null}),{resetOnSuccess:!1})},onTaxonSelect:function(t){var e=this;this.form.taxon=t||null,this.form.taxon_id=t?t.id:null,this.taxonName=t?t.name:null,!m()(this.stages,(function(t){return t.id===e.form.stage_id}))&&(this.form.stage_id=null)},onCollectionSelect:function(t){this.form.collection=t||null,this.form.collection_id=t?t.id:null,this.collectionName=t?t.name:null},onTimeInput:function(t){this.form.time=t?Object(a.a)(t).format("HH:mm"):null},getAttributesToKeep:function(){return["location","accuracy","elevation","latitude","longitude","year","month","day","project","observer","identifier","dataset","collection","collection_id","minimum_elevation","maximum_elevation","original_locality","original_elevation","original_coordinates","georeferenced_by","georeferenced_date"]},hookAfterSubmitWithoutRedirect:function(){this.taxonName=""},addNewCollection:function(){this.saveState(),window.location.href=route("admin.specimen-collections.create")},dateFormater:function(t){return Object(a.a)(t).format("DD.MM.YYYY")},handleElevationFetched:function(t){this.form.minimum_elevation=t,this.form.maximum_elevation=t},submitWithoutRedirectWithSameTaxon:function(){if(!this.form.processing)return this.submitOnlyDirty&&!this.isDirty()?this.notifyNoChanges():this.shouldConfirmSubmit?this.confirmSubmit(this.performSubmitWithoutRedirectWithSameTaxon):void this.performSubmitWithoutRedirectWithSameTaxon()},performSubmitWithoutRedirectWithSameTaxon:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.submittingWithoutRedirectWithSameTaxon=!0,this.confirmingSubmit=!1,this.shouldAskReason&&(this.form.reason=e),this.form[this.method.toLowerCase()](this.action).then(this.onSuccessfulSubmitWithoutRedirectWithSameTaxon).catch((function(e){t.submittingWithoutRedirectWithSameTaxon=!1,t.onFailedSubmit(e)}))},onSuccessfulSubmitWithoutRedirectWithSameTaxon:function(){this.submittingWithoutRedirectWithSameTaxon=!1,this.$buefy.toast.open({message:this.trans("Saved successfully"),type:"is-success"});var t=b()(this.form.data(),this.keepAfterSubmit.concat(["original_identification_validity","taxon","taxon_id","original_identification"]));this.form.reset(),this.form.populate(t)},getObservationPhotoAttribute:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"url",o=c()(this.observation,"photos.".concat(t,".").concat(e),"");if("url"===e&&o){var r=Object(a.a)(c()(this.observation,"photos.".concat(t,".updated_at"),null));o+=r.isValid()?"?v=".concat(r.format("X")):""}return o},onPhotoUploaded:function(t){this.form.photos.push({path:t.path,crop:t.crop,license:t.license}),this.promptToExtractExifData(t)},promptToExtractExifData:function(t){var e=this;!this.exifExtracted&&t.exif&&this.$buefy.dialog.confirm({message:this.extractExifMessage(t).replace(/\n/g,"<br>"),cancelText:this.trans("No"),confirmText:this.trans("Yes"),onConfirm:function(){e.fillFromExif(t)},onCancel:function(){e.exifExtracted=!0}})},extractExifMessage:function(t){var e=this,o=this.extractExifData(t);return[this.trans("Use data from photo to fill the form?")+"\n"].concat($(Object.keys(o).map((function(t){return"".concat(e.trans("labels.collection_observations."+t),": ").concat(o[t])})))).join("\n")},extractExifData:function(t){var e={};for(var o in t.exif){var r=t.exif[o];r&&(e[o]=r)}return e},fillFromExif:function(t){var e=this.extractExifData(t);for(var o in e)this.form[o]=e[o];this.exifExtracted=!0},onPhotoRemoved:function(t){v()(this.form.photos,{path:t.path})},onPhotoCropped:function(t){var e=d()(this.form.photos,{path:t.path});if(e>=0){var o=s()(this.form.photos[e]);o.crop=t.crop,this.form.photos.splice(e,1,o)}},onLicenseChanged:function(t,e){var o=s()(this.form.photos[t]);o.license=e,this.form.photos[t]=o}}},W=Object(P.a)(R,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("form",{staticClass:"collection-observation-form",attrs:{action:t.action,method:"POST",lang:t.locale}},[o("div",{staticClass:"mb-8"},[o("nz-collection-autocomplete",{staticClass:"is-required",attrs:{collection:t.form.collection,error:t.form.errors.has("collection_id"),message:t.form.errors.has("collection_id")?t.form.errors.first("collection_id"):null,autofocus:"autofocus",label:t.trans("labels.collection_observations.collection"),placeholder:t.trans("labels.collection_observations.search_for_collection")},on:{select:t.onCollectionSelect},model:{value:t.collectionName,callback:function(e){t.collectionName=e},expression:"collectionName"}},[o("a",{staticClass:"button",attrs:{title:t.trans("labels.collection_observations.add_new_collection"),href:t.$ziggy("admin.specimen-collections.create")},on:{click:function(e){return e.preventDefault(),t.addNewCollection(e)}}},[o("b-icon",{attrs:{icon:"plus"}})],1)]),t._v(" "),o("nz-taxon-autocomplete",{ref:"taxonAutocomplete",staticClass:"is-required",attrs:{taxon:t.form.taxon,error:t.form.errors.has("taxon_id"),message:t.form.errors.has("taxon_id")?t.form.errors.first("taxon_id"):null,autofocus:"autofocus",label:t.trans("labels.collection_observations.taxon"),placeholder:t.trans("labels.collection_observations.search_for_taxon")},on:{select:t.onTaxonSelect},model:{value:t.taxonName,callback:function(e){t.taxonName=e},expression:"taxonName"}}),t._v(" "),o("nz-date-input",{attrs:{year:t.form.year,month:t.form.month,day:t.form.day,errors:t.form.errors,label:t.trans("labels.collection_observations.date"),placeholders:{year:t.trans("labels.collection_observations.year"),month:t.trans("labels.collection_observations.month"),day:t.trans("labels.collection_observations.day")}},on:{"update:year":function(e){return t.$set(t.form,"year",e)},"update:month":function(e){return t.$set(t.form,"month",e)},"update:day":function(e){return t.$set(t.form,"day",e)}}}),t._v(" "),o("div",{staticClass:"columns"},[o("div",{staticClass:"column"},[o("b-field",{staticClass:"is-required",attrs:{label:t.trans("labels.collection_observations.original_identification"),type:t.form.errors.has("original_identification")?"is-danger":null,message:t.form.errors.has("original_identification")?t.form.errors.first("original_identification"):null}},[o("b-input",{attrs:{name:"original_identification"},model:{value:t.form.original_identification,callback:function(e){t.$set(t.form,"original_identification",e)},expression:"form.original_identification"}})],1)],1),t._v(" "),o("div",{staticClass:"column"},[o("b-field",{staticClass:"is-required",attrs:{label:t.trans("labels.collection_observations.original_identification_validity"),type:t.form.errors.has("original_identification_validity")?"is-danger":null,message:t.form.errors.has("original_identification_validity")?t.form.errors.first("original_identification_validity"):null}},[o("b-select",{attrs:{name:"original_identification_validity",expanded:""},model:{value:t.form.original_identification_validity,callback:function(e){t.$set(t.form,"original_identification_validity",e)},expression:"form.original_identification_validity"}},t._l(t.validityOptions,(function(e,r){return o("option",{key:r,domProps:{value:r}},[t._v(t._s(e))])})),0)],1)],1)]),t._v(" "),o("nz-spatial-input",{staticClass:"mb-4",attrs:{latitude:t.form.latitude,longitude:t.form.longitude,location:t.form.location,accuracy:t.form.accuracy,elevation:t.form.elevation,errors:t.form.errors,"has-other-errors":t.form.errors.has("minimum_elevation")||t.form.errors.has("maximum_elevation")},on:{"update:latitude":function(e){return t.$set(t.form,"latitude",e)},"update:longitude":function(e){return t.$set(t.form,"longitude",e)},"update:location":function(e){return t.$set(t.form,"location",e)},"update:accuracy":function(e){return t.$set(t.form,"accuracy",e)},"update:elevation":function(e){return t.$set(t.form,"elevation",e)},"elevation-fetched":t.handleElevationFetched}},[o("b-field",{attrs:{label:t.trans("labels.collection_observations.minimum_elevation_m"),type:t.form.errors.has("minimum_elevation")?"is-danger":null,message:t.form.errors.has("minimum_elevation")?t.form.errors.first("minimum_elevation"):null,"custom-class":"is-small"}},[o("b-input",{attrs:{type:"number",size:"is-small"},model:{value:t.form.minimum_elevation,callback:function(e){t.$set(t.form,"minimum_elevation",t._n(e))},expression:"form.minimum_elevation"}})],1),t._v(" "),o("b-field",{attrs:{label:t.trans("labels.collection_observations.maximum_elevation_m"),type:t.form.errors.has("maximum_elevation")?"is-danger":null,message:t.form.errors.has("maximum_elevation")?t.form.errors.first("maximum_elevation"):null,"custom-class":"is-small"}},[o("b-input",{attrs:{type:"number",size:"is-small"},model:{value:t.form.maximum_elevation,callback:function(e){t.$set(t.form,"maximum_elevation",t._n(e))},expression:"form.maximum_elevation"}})],1)],1),t._v(" "),o("div",{staticClass:"columns"},[o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.collection_observations.georeferenced_by"),type:t.form.errors.has("georeferenced_by")?"is-danger":null,message:t.form.errors.has("georeferenced_by")?t.form.errors.first("georeferenced_by"):null}},[o("b-input",{model:{value:t.form.georeferenced_by,callback:function(e){t.$set(t.form,"georeferenced_by",t._n(e))},expression:"form.georeferenced_by"}})],1)],1),t._v(" "),o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.collection_observations.georeferenced_date"),type:t.form.errors.has("georeferenced_date")?"is-danger":null,message:t.form.errors.has("georeferenced_date")?t.form.errors.first("georeferenced_date"):null}},[o("b-datepicker",{attrs:{"max-date":new Date,"mobile-native":!1,"date-formatter":t.dateFormater,"first-day-of-week":1,placeholder:"DD.MM.YYYY"},model:{value:t.georeferencedDate,callback:function(e){t.georeferencedDate=e},expression:"georeferencedDate"}},[o("button",{staticClass:"button is-danger",attrs:{type:"button"},on:{click:function(e){t.form.georeferenced_date=null}}},[o("b-icon",{attrs:{icon:"close"}}),t._v(" "),o("span",[t._v("Clear")])],1)])],1)],1)]),t._v(" "),o("div",{staticClass:"columns"},[o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.collection_observations.stage"),type:t.form.errors.has("stage_id")?"is-danger":null,message:t.form.errors.has("stage_id")?t.form.errors.first("stage_id"):null}},[o("b-select",{attrs:{disabled:!t.stages.length,expanded:"expanded"},model:{value:t.form.stage_id,callback:function(e){t.$set(t.form,"stage_id",e)},expression:"form.stage_id"}},[o("option",{domProps:{value:null}},[t._v(t._s(t.trans("labels.collection_observations.choose_a_stage")))]),t._v(" "),t._l(t.stages,(function(e){return o("option",{key:e.id,domProps:{value:e.id,textContent:t._s(t.trans("stages."+e.name))}})}))],2)],1)],1),t._v(" "),o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.collection_observations.sex"),type:t.form.errors.has("sex")?"is-danger":null,message:t.form.errors.has("sex")?t.form.errors.first("sex"):null}},[o("b-select",{attrs:{expanded:"expanded"},model:{value:t.form.sex,callback:function(e){t.$set(t.form,"sex",e)},expression:"form.sex"}},[o("option",{domProps:{value:null}},[t._v(t._s(t.trans("labels.collection_observations.choose_a_value")))]),t._v(" "),t._l(t.sexes,(function(e,r){return o("option",{key:r,domProps:{value:r,textContent:t._s(e)}})}))],2)],1)],1),t._v(" "),o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.collection_observations.number"),type:t.form.errors.has("number")?"is-danger":null,message:t.form.errors.has("number")?t.form.errors.first("number"):null}},[o("b-input",{attrs:{type:"number"},model:{value:t.form.number,callback:function(e){t.$set(t.form,"number",e)},expression:"form.number"}})],1)],1)]),t._v(" "),o("div",{staticClass:"mt-4"},[o("div",{staticClass:"columns"},[o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.collection_observations.habitat"),type:t.form.errors.has("habitat")?"is-danger":null,message:t.form.errors.has("habitat")?t.form.errors.first("habitat"):null}},[o("b-input",{model:{value:t.form.habitat,callback:function(e){t.$set(t.form,"habitat",e)},expression:"form.habitat"}})],1)],1),t._v(" "),o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.collection_observations.found_on"),type:t.form.errors.has("found_on")?"is-danger":null,message:t.form.errors.has("found_on")?t.form.errors.first("found_on"):null}},[o("label",{staticClass:"label",attrs:{slot:"label",for:"found_on"},slot:"label"},[o("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.trans("labels.collection_observations.found_on_tooltip")},expression:"{content: trans('labels.collection_observations.found_on_tooltip')}"}],staticClass:"is-dashed"},[t._v("\n                "+t._s(t.trans("labels.collection_observations.found_on"))+"\n              ")])]),t._v(" "),o("b-input",{attrs:{id:"found_on",name:"found_on"},model:{value:t.form.found_on,callback:function(e){t.$set(t.form,"found_on",e)},expression:"form.found_on"}})],1)],1)]),t._v(" "),o("b-field",{attrs:{label:t.trans("labels.collection_observations.time"),type:t.form.errors.has("time")?"is-danger":null,message:t.form.errors.has("time")?t.form.errors.first("time"):null}},[o("b-timepicker",{attrs:{value:t.time,placeholder:t.trans("labels.collection_observations.click_to_select"),icon:"clock-o","mobile-native":!1},on:{input:t.onTimeInput}},[o("button",{staticClass:"button is-danger",attrs:{type:"button"},on:{click:function(e){t.form.time=null}}},[o("b-icon",{attrs:{icon:"close"}})],1)])],1),t._v(" "),o("div",{staticClass:"columns"},[o("div",{staticClass:"column"},[o("div",{staticClass:"field"},[o("label",{staticClass:"label",attrs:{for:"project"}},[o("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.trans("labels.collection_observations.project_tooltip")},expression:"{content: trans('labels.collection_observations.project_tooltip')}"}],staticClass:"is-dashed"},[t._v("\n                "+t._s(t.trans("labels.collection_observations.project"))+"\n              ")])]),t._v(" "),o("b-input",{attrs:{id:"project",name:"project"},model:{value:t.form.project,callback:function(e){t.$set(t.form,"project",e)},expression:"form.project"}}),t._v(" "),t.form.errors.has("project")?o("p",{staticClass:"help",class:{"is-danger":t.form.errors.has("project")},domProps:{innerHTML:t._s(t.form.errors.first("project"))}}):t._e()],1)]),t._v(" "),o("div",{staticClass:"column"},[o("div",{staticClass:"field"},[o("label",{staticClass:"label",attrs:{for:"dataset"}},[t._v("\n              "+t._s(t.trans("labels.collection_observations.dataset"))+"\n            ")]),t._v(" "),o("b-input",{attrs:{id:"dataset",name:"dataset"},model:{value:t.form.dataset,callback:function(e){t.$set(t.form,"dataset",e)},expression:"form.dataset"}}),t._v(" "),t.form.errors.has("dataset")?o("p",{staticClass:"help",class:{"is-danger":t.form.errors.has("dataset")},domProps:{innerHTML:t._s(t.form.errors.first("dataset"))}}):t._e()],1)])]),t._v(" "),o("div",{staticClass:"columns"},[o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.collection_observations.observer"),type:t.form.errors.has("observer")?"is-danger":null,message:t.form.errors.has("observer")?t.form.errors.first("observer"):null}},[o("b-input",{attrs:{name:"observer"},model:{value:t.form.observer,callback:function(e){t.$set(t.form,"observer",e)},expression:"form.observer"}})],1)],1),t._v(" "),o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.collection_observations.identifier"),type:t.form.errors.has("identifier")?"is-danger":null,message:t.form.errors.has("identifier")?t.form.errors.first("identifier"):null}},[o("b-input",{attrs:{name:"identifier"},model:{value:t.form.identifier,callback:function(e){t.$set(t.form,"identifier",e)},expression:"form.identifier"}})],1)],1)])],1),t._v(" "),o("div",{staticClass:"columns"},[o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.collection_observations.collector"),type:t.form.errors.has("collector")?"is-danger":null,message:t.form.errors.has("collector")?t.form.errors.first("collector"):null}},[o("b-input",{attrs:{name:"collector"},model:{value:t.form.collector,callback:function(e){t.$set(t.form,"collector",e)},expression:"form.collector"}})],1)],1),t._v(" "),o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.collection_observations.preparator"),type:t.form.errors.has("preparator")?"is-danger":null,message:t.form.errors.has("preparator")?t.form.errors.first("preparator"):null}},[o("b-input",{attrs:{name:"preparator"},model:{value:t.form.preparator,callback:function(e){t.$set(t.form,"preparator",e)},expression:"form.preparator"}})],1)],1)])],1),t._v(" "),o("div",{staticClass:"columns"},[o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.collection_observations.catalogue_number"),type:t.form.errors.has("catalogue_number")?"is-danger":null,message:t.form.errors.has("catalogue_number")?t.form.errors.first("catalogue_number"):null}},[o("b-input",{attrs:{name:"catalogue_number"},model:{value:t.form.catalogue_number,callback:function(e){t.$set(t.form,"catalogue_number",e)},expression:"form.catalogue_number"}})],1)],1),t._v(" "),o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.collection_observations.cabinet_number"),type:t.form.errors.has("cabinet_number")?"is-danger":null,message:t.form.errors.has("cabinet_number")?t.form.errors.first("cabinet_number"):null}},[o("b-input",{attrs:{name:"cabinet_number"},model:{value:t.form.cabinet_number,callback:function(e){t.$set(t.form,"cabinet_number",e)},expression:"form.cabinet_number"}})],1)],1),t._v(" "),o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.collection_observations.box_number"),type:t.form.errors.has("box_number")?"is-danger":null,message:t.form.errors.has("box_number")?t.form.errors.first("box_number"):null}},[o("b-input",{attrs:{name:"box_number"},model:{value:t.form.box_number,callback:function(e){t.$set(t.form,"box_number",e)},expression:"form.box_number"}})],1)],1)]),t._v(" "),o("div",{staticClass:"columns"},[o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.collection_observations.disposition"),type:t.form.errors.has("disposition")?"is-danger":null,message:t.form.errors.has("disposition")?t.form.errors.first("disposition"):null}},[o("b-select",{attrs:{expanded:"expanded"},model:{value:t.form.disposition,callback:function(e){t.$set(t.form,"disposition",e)},expression:"form.disposition"}},[o("option",{domProps:{value:null}},[t._v(t._s(t.trans("labels.collection_observations.choose_a_value")))]),t._v(" "),t._l(t.dispositions,(function(e,r){return o("option",{key:r,domProps:{value:r,textContent:t._s(e)}})}))],2)],1)],1),t._v(" "),o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.collection_observations.preparation_method"),type:t.form.errors.has("preparation_method")?"is-danger":null,message:t.form.errors.has("preparation_method")?t.form.errors.first("preparation_method"):null}},[o("b-input",{attrs:{name:"preparation_method"},model:{value:t.form.preparation_method,callback:function(e){t.$set(t.form,"preparation_method",e)},expression:"form.preparation_method"}})],1)],1)]),t._v(" "),o("b-field",{attrs:{label:t.trans("labels.collection_observations.note"),error:t.form.errors.has("note"),message:t.form.errors.has("note")?t.form.errors.first("note"):null}},[o("b-input",{attrs:{type:"textarea"},model:{value:t.form.note,callback:function(e){t.$set(t.form,"note",e)},expression:"form.note"}})],1),t._v(" "),o("div",{staticClass:"mt-8"},[o("h2",{staticClass:"is-size-4"},[t._v(t._s(t.trans("labels.collection_observations.verbatim_data")))]),t._v(" "),o("div",{staticClass:"columns"},[o("b-field",{staticClass:"column",attrs:{label:t.trans("labels.collection_observations.original_date"),type:t.form.errors.has("original_date")?"is-danger":null,message:t.form.errors.has("original_date")?t.form.errors.first("original_date"):null}},[o("b-input",{attrs:{name:"original_date"},model:{value:t.form.original_date,callback:function(e){t.$set(t.form,"original_date",e)},expression:"form.original_date"}})],1),t._v(" "),o("b-field",{staticClass:"column",attrs:{label:t.trans("labels.collection_observations.original_locality"),type:t.form.errors.has("original_locality")?"is-danger":null,message:t.form.errors.has("original_locality")?t.form.errors.first("original_locality"):null}},[o("b-input",{model:{value:t.form.original_locality,callback:function(e){t.$set(t.form,"original_locality",e)},expression:"form.original_locality"}})],1)],1),t._v(" "),o("div",{staticClass:"columns"},[o("b-field",{staticClass:"column",attrs:{label:t.trans("labels.collection_observations.original_coordinates"),type:t.form.errors.has("original_coordinates")?"is-danger":null,message:t.form.errors.has("original_coordinates")?t.form.errors.first("original_coordinates"):null}},[o("b-input",{model:{value:t.form.original_coordinates,callback:function(e){t.$set(t.form,"original_coordinates",e)},expression:"form.original_coordinates"}})],1),t._v(" "),o("b-field",{staticClass:"column",attrs:{label:t.trans("labels.collection_observations.original_elevation"),type:t.form.errors.has("original_elevation")?"is-danger":null,message:t.form.errors.has("original_elevation")?t.form.errors.first("original_elevation"):null}},[o("b-input",{attrs:{placeholder:t.trans("labels.collection_observations.original_elevation_placeholder")},model:{value:t.form.original_elevation,callback:function(e){t.$set(t.form,"original_elevation",e)},expression:"form.original_elevation"}})],1)],1),t._v(" "),o("b-field",{staticClass:"mb-8",attrs:{label:t.trans("labels.collection_observations.verbatim_tag"),type:t.form.errors.has("verbatim_tag")?"is-danger":null,message:t.form.errors.has("verbatim_tag")?t.form.errors.first("verbatim_tag"):null}},[o("b-input",{attrs:{type:"textarea"},model:{value:t.form.verbatim_tag,callback:function(e){t.$set(t.form,"verbatim_tag",e)},expression:"form.verbatim_tag"}})],1),t._v(" "),o("div",{staticClass:"columns"},[o("b-field",{staticClass:"column",attrs:{label:t.trans("labels.collection_observations.collecting_start_year"),type:t.form.errors.has("collecting_start_year")?"is-danger":null,message:t.form.errors.has("collecting_start_year")?t.form.errors.first("collecting_start_year"):null}},[o("b-input",{attrs:{type:"number"},model:{value:t.form.collecting_start_year,callback:function(e){t.$set(t.form,"collecting_start_year",e)},expression:"form.collecting_start_year"}})],1),t._v(" "),o("b-field",{staticClass:"column",attrs:{label:t.trans("labels.collection_observations.collecting_start_month"),type:t.form.errors.has("collecting_start_month")?"is-danger":null,message:t.form.errors.has("collecting_start_month")?t.form.errors.first("collecting_start_month"):null}},[o("b-select",{attrs:{expanded:""},model:{value:t.form.collecting_start_month,callback:function(e){t.$set(t.form,"collecting_start_month",e)},expression:"form.collecting_start_month"}},[o("option",{domProps:{value:null}}),t._v(" "),t._l(t.months,(function(e,r){return o("option",{key:e,domProps:{value:r+1}},[t._v("\n                  "+t._s(e)+"\n              ")])}))],2)],1)],1),t._v(" "),o("div",{staticClass:"columns"},[o("b-field",{staticClass:"column",attrs:{label:t.trans("labels.collection_observations.collecting_end_year"),type:t.form.errors.has("collecting_end_year")?"is-danger":null,message:t.form.errors.has("collecting_end_year")?t.form.errors.first("collecting_end_year"):null}},[o("b-input",{attrs:{type:"number"},model:{value:t.form.collecting_end_year,callback:function(e){t.$set(t.form,"collecting_end_year",e)},expression:"form.collecting_end_year"}})],1),t._v(" "),o("b-field",{staticClass:"column",attrs:{label:t.trans("labels.collection_observations.collecting_end_month"),type:t.form.errors.has("collecting_end_month")?"is-danger":null,message:t.form.errors.has("collecting_end_month")?t.form.errors.first("collecting_end_month"):null}},[o("b-select",{attrs:{expanded:""},model:{value:t.form.collecting_end_month,callback:function(e){t.$set(t.form,"collecting_end_month",e)},expression:"form.collecting_end_month"}},[o("option",{domProps:{value:null}}),t._v(" "),t._l(t.months,(function(e,r){return o("option",{key:e,domProps:{value:r+1}},[t._v("\n                  "+t._s(e)+"\n              ")])}))],2)],1)],1),t._v(" "),o("b-field",{attrs:{label:t.trans("labels.collection_observations.photos")}},[o("div",{staticClass:"columns"},[o("div",{staticClass:"column is-one-third"},[o("nz-photo-upload",{ref:"photoUpload-1",attrs:{"image-url":t.getObservationPhotoAttribute(0,"url"),"image-path":t.getObservationPhotoAttribute(0,"path"),"image-license":t.getObservationPhotoAttribute(0,"license"),licenses:t.licenses,text:t.trans("labels.collection_observations.upload"),errors:t.form.errors},on:{uploaded:t.onPhotoUploaded,removed:t.onPhotoRemoved,cropped:t.onPhotoCropped,"license-changed":function(e){return t.onLicenseChanged(0,e)}}})],1),t._v(" "),o("div",{staticClass:"column is-one-third"},[o("nz-photo-upload",{ref:"photoUpload-2",attrs:{"image-path":t.getObservationPhotoAttribute(1,"path"),"image-url":t.getObservationPhotoAttribute(1,"url"),"image-license":t.getObservationPhotoAttribute(1,"license"),licenses:t.licenses,text:t.trans("labels.collection_observations.upload"),errors:t.form.errors},on:{uploaded:t.onPhotoUploaded,removed:t.onPhotoRemoved,cropped:t.onPhotoCropped,"license-changed":function(e){return t.onLicenseChanged(1,e)}}})],1),t._v(" "),o("div",{staticClass:"column is-one-third"},[o("nz-photo-upload",{ref:"photoUpload-3",attrs:{"image-url":t.getObservationPhotoAttribute(2,"url"),"image-path":t.getObservationPhotoAttribute(2,"path"),"image-license":t.getObservationPhotoAttribute(2,"license"),licenses:t.licenses,text:t.trans("labels.collection_observations.upload"),errors:t.form.errors},on:{uploaded:t.onPhotoUploaded,removed:t.onPhotoRemoved,cropped:t.onPhotoCropped,"license-changed":function(e){return t.onLicenseChanged(2,e)}}})],1)])])],1),t._v(" "),o("hr"),t._v(" "),o("button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.trans("labels.collection_observations.save_tooltip")},expression:"{content: trans('labels.collection_observations.save_tooltip')}"}],staticClass:"button is-primary",class:{"is-loading":t.submittingWithRedirect},attrs:{type:"submit"},on:{click:function(e){return e.preventDefault(),t.submitWithRedirect(e)}}},[t._v("\n    "+t._s(t.trans("buttons.save"))+"\n  ")]),t._v(" "),t.submitMore?o("button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.trans("labels.collection_observations.save_more_tooltip")},expression:"{content: trans('labels.collection_observations.save_more_tooltip')}"}],staticClass:"button is-primary",class:{"is-outlined":!t.submittingWithoutRedirect,"is-loading":t.submittingWithoutRedirect},attrs:{type:"submit"},on:{click:function(e){return e.preventDefault(),t.submitWithoutRedirect(e)}}},[t._v("\n    "+t._s(t.trans("buttons.save_more"))+"\n  ")]):t._e(),t._v(" "),t.submitMoreWithSameTaxon?o("button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.trans("labels.collection_observations.save_more_same_taxon_tooltip")},expression:"{content: trans('labels.collection_observations.save_more_same_taxon_tooltip')}"}],staticClass:"button is-primary",class:{"is-outlined":!t.submittingWithoutRedirectWithSameTaxon,"is-loading":t.submittingWithoutRedirectWithSameTaxon},attrs:{type:"button"},on:{click:function(e){return e.preventDefault(),t.submitWithoutRedirectWithSameTaxon(e)}}},[t._v("\n    "+t._s(t.trans("labels.collection_observations.save_more_same_taxon"))+"\n  ")]):t._e(),t._v(" "),o("a",{staticClass:"button is-text",attrs:{href:t.cancelUrl},on:{click:t.onCancel}},[t._v(t._s(t.trans("buttons.cancel")))])],1)}),[],!1,null,null,null);e.default=W.exports},BkRI:function(t,e,o){var r=o("OBhP");t.exports=function(t){return r(t,5)}},"Dw+G":function(t,e,o){var r=o("juv8"),n=o("mTTR");t.exports=function(t,e){return t&&r(e,n(e),t)}},EEGq:function(t,e,o){var r=o("juv8"),n=o("oCl/");t.exports=function(t,e){return r(t,n(t),e)}},G6z8:function(t,e,o){var r=o("fR/l"),n=o("oCl/"),a=o("mTTR");t.exports=function(t){return r(t,a,n)}},Gi0A:function(t,e,o){var r=o("QqLw"),n=o("ExA7");t.exports=function(t){return n(t)&&"[object Map]"==r(t)}},KxBF:function(t,e){t.exports=function(t,e,o){var r=-1,n=t.length;e<0&&(e=-e>n?0:n+e),(o=o>n?n:o)<0&&(o+=n),n=e>o?0:o-e>>>0,e>>>=0;for(var a=Array(n);++r<n;)a[r]=t[r+e];return a}},OBhP:function(t,e,o){var r=o("fmRc"),n=o("gFfm"),a=o("MrPd"),i=o("WwFo"),s=o("Dw+G"),l=o("5Tg0"),c=o("Q1l4"),u=o("VOtZ"),m=o("EEGq"),f=o("qZTm"),d=o("G6z8"),p=o("QqLw"),b=o("yHx3"),h=o("wrZu"),v=o("+iFO"),_=o("Z0cm"),g=o("DSRE"),y=o("zEVN"),x=o("GoyQ"),C=o("1+5i"),w=o("7GkX"),j={};j["[object Arguments]"]=j["[object Array]"]=j["[object ArrayBuffer]"]=j["[object DataView]"]=j["[object Boolean]"]=j["[object Date]"]=j["[object Float32Array]"]=j["[object Float64Array]"]=j["[object Int8Array]"]=j["[object Int16Array]"]=j["[object Int32Array]"]=j["[object Map]"]=j["[object Number]"]=j["[object Object]"]=j["[object RegExp]"]=j["[object Set]"]=j["[object String]"]=j["[object Symbol]"]=j["[object Uint8Array]"]=j["[object Uint8ClampedArray]"]=j["[object Uint16Array]"]=j["[object Uint32Array]"]=!0,j["[object Error]"]=j["[object Function]"]=j["[object WeakMap]"]=!1,t.exports=function t(e,o,S,k,O,P){var E,A=1&o,$=2&o,I=4&o;if(S&&(E=O?S(e,k,O,P):S(e)),void 0!==E)return E;if(!x(e))return e;var T=_(e);if(T){if(E=b(e),!A)return c(e,E)}else{var D=p(e),M="[object Function]"==D||"[object GeneratorFunction]"==D;if(g(e))return l(e,A);if("[object Object]"==D||"[object Arguments]"==D||M&&!O){if(E=$||M?{}:v(e),!A)return $?m(e,s(E,e)):u(e,i(E,e))}else{if(!j[D])return O?e:{};E=h(e,D,A)}}P||(P=new r);var R=P.get(e);if(R)return R;P.set(e,E),C(e)?e.forEach((function(r){E.add(t(r,o,S,r,e,P))})):y(e)&&e.forEach((function(r,n){E.set(n,t(r,o,S,n,e,P))}));var W=I?$?d:f:$?keysIn:w,U=T?void 0:W(e);return n(U||e,(function(r,n){U&&(r=e[n=r]),a(E,n,t(r,o,S,n,e,P))})),E}},RBan:function(t,e){t.exports=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0}},S7Xf:function(t,e,o){var r=o("4uTw"),n=o("RBan"),a=o("gpbi"),i=o("9Nap");t.exports=function(t,e){return e=r(e,t),null==(t=a(t,e))||delete t[i(n(e))]}},VOtZ:function(t,e,o){var r=o("juv8"),n=o("MvSz");t.exports=function(t,e){return r(t,n(t),e)}},WwFo:function(t,e,o){var r=o("juv8"),n=o("7GkX");t.exports=function(t,e){return t&&r(e,n(e),t)}},XYm9:function(t,e,o){var r=o("+K+b");t.exports=function(t,e){var o=e?r(t.buffer):t.buffer;return new t.constructor(o,t.byteOffset,t.byteLength)}},b2z7:function(t,e){var o=/\w*$/;t.exports=function(t){var e=new t.constructor(t.source,o.exec(t));return e.lastIndex=t.lastIndex,e}},f5xI:function(t,e,o){var r=o("S7Xf"),n=o("wJg7"),a=Array.prototype.splice;t.exports=function(t,e){for(var o=t?e.length:0,i=o-1;o--;){var s=e[o];if(o==i||s!==l){var l=s;n(s)?a.call(t,s,1):r(t,s)}}return t}},gFfm:function(t,e){t.exports=function(t,e){for(var o=-1,r=null==t?0:t.length;++o<r&&!1!==e(t[o],o,t););return t}},gpbi:function(t,e,o){var r=o("ZWtO"),n=o("KxBF");t.exports=function(t,e){return e.length<2?t:r(t,n(e,0,-1))}},nWYc:function(t,e,o){"use strict";var r=o("+9FD"),n=o.n(r),a=o("dfMu"),i=o.n(a),s=o("T5TR");function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function m(t,e){return(m=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,r=p(t);if(e){var n=p(this).constructor;o=Reflect.construct(r,arguments,n)}else o=r.apply(this,arguments);return d(this,o)}}function d(t,e){return!e||"object"!==l(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var b=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&m(t,e)}(a,t);var e,o,r,n=f(a);function a(){return c(this,a),n.apply(this,arguments)}return e=a,(o=[{key:"setBoxToRealPosition",value:function(t){var e=this.imageEl.naturalWidth,o=this.imageEl.naturalHeight,r=e/this.imageEl.offsetWidth,n=o/this.imageEl.offsetHeight;this.box=new s.a(Math.round(t.x/r),Math.round(t.y/n),Math.round((t.x+t.width)/r),Math.round((t.y+t.height)/n)),this.redraw()}}])&&u(e.prototype,o),r&&u(e,r),a}(i.a),h={name:"nzImageCropModal",mixins:[o("aa4y").a],props:{canCancel:{type:[Array,Boolean],default:function(){return["escape","x"]}},imageUrl:String,crop:Object},data:function(){return{croppr:null,newCrop:this.crop,preserveRatio:!1}},mounted:function(){document.addEventListener("keydown",this.ctrlIsPressed),document.addEventListener("keyup",this.ctrlIsNotPressed)},beforeDestroy:function(){document.removeEventListener("keydown",this.ctrlIsPressed),document.removeEventListener("keyup",this.ctrlIsNotPressed)},watch:{isActive:function(t){var e=this;this.handleScroll(),this.croppr=null,t&&this.$nextTick((function(){e.croppr=new b(e.$refs.cropModalImage,{onCropEnd:function(t){e.newCrop=t},onInitialize:function(t){e.newCrop&&t.setBoxToRealPosition(e.newCrop)}})}))}},methods:{handleScroll:function(){"undefined"!=typeof window&&(this.savedScrollTop=this.savedScrollTop?this.savedScrollTop:document.documentElement.scrollTop,document.body.classList.toggle("is-noscroll",this.isActive),this.isActive?document.body.style.top="-".concat(this.savedScrollTop,"px"):(document.documentElement.scrollTop=this.savedScrollTop,document.body.style.top=null,this.savedScrollTop=null))},cropImage:function(){this.$emit("update:crop",this.newCrop),this.close()},ctrlIsPressed:function(t){17==t.which&&this.croppr&&(this.croppr.options.aspectRatio=this.croppr.box.height()/this.croppr.box.width())},ctrlIsNotPressed:function(t){17==t.which&&this.croppr&&(this.croppr.options.aspectRatio=null)}}},v=o("KHd+"),_={name:"nzPhotoUpload",components:{NzImageCropModal:Object(v.a)(h,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("transition",{attrs:{name:t.animation}},[t.isActive?o("div",{staticClass:"modal is-active"},[o("div",{staticClass:"modal-background"}),t._v(" "),o("div",{staticClass:"animation-content modal-content",style:{maxWidth:t.newWidth}},[o("img",{ref:"cropModalImage",staticClass:"image",attrs:{src:t.imageUrl,alt:"Cropped image"}})]),t._v(" "),o("button",{staticClass:"modal-close is-large",attrs:{type:"button"},on:{click:function(e){return t.cancel("x")}}}),t._v(" "),o("button",{staticClass:"modal-action",attrs:{type:"button"},on:{click:t.cropImage}},[o("b-icon",{attrs:{icon:"check"}})],1)]):t._e()])}),[],!1,null,null,null).exports,NzImageModal:o("slQF").a},props:{imageUrl:{type:String,default:null},imagePath:{type:String,default:null},imageLicense:{type:[Number,String],default:null},licenses:{type:Object,required:!0},text:String,withLicense:{type:Boolean,default:!0},withCrop:{type:Boolean,default:!0}},data:function(){return{image:{url:this.imageUrl,path:this.imagePath,crop:null,license:this.imageLicense},croppedImageUrl:null,reader:null,uploading:!1,loading:!1,progress:0,hasExisting:!!this.imageUrl,error:null,showCropModal:!1,showModal:!1}},watch:{"image.crop":function(t){this.$emit("cropped",this.image),t?this.cropThumbnail(t):this.croppedImageUrl=null}},computed:{haveImage:function(){return!!this.image.url},thumbnailUrl:function(){return this.croppedImageUrl||this.image.url}},methods:{selectImage:function(){this.$refs.input.click()},onInput:function(t){this.error=null,t&&this.upload(t)},upload:function(t){var e=this;return this.uploading=!0,axios.post(route("api.photo-uploads.store"),this.makeForm(t),{headers:{"Content-Type":"multipart/form-data",Accept:"application/json"},onUploadProgress:function(t){e.progress=Math.floor(100*t.loaded/t.total)}}).then((function(o){e.image.path=o.data.file,e.image.exif=o.data.exif,e.image.license=null,e.uploading=!1,e.progress=0,e.$emit("uploaded",e.image),e.loading=!0,n()(t,(function(t){e.image.url=e.getImageDataUrl(t),e.loading=!1}),{orientation:!0})})).catch(this.handleError)},getImageDataUrl:function(t){var e=t;return e instanceof HTMLCanvasElement||((e=document.createElement("canvas")).setAttribute("width",t.width),e.setAttribute("height",t.height),e.getContext("2d").drawImage(t,0,0)),e.toDataURL()},makeForm:function(t){var e=new FormData;return e.append("file",t),e},remove:function(){var t=this;if(this.hasExisting)return this.hasExisting=!1,this.clearPhoto();axios.delete(route("api.photo-uploads.destroy",this.image.path)).then((function(){t.clearPhoto()}))},clearPhoto:function(){this.$emit("removed",this.image),this.image.path=null,this.image.url=null,this.image.crop=null,this.image.license=null,this.croppedImageUrl=null},handleError:function(t){if(this.uploading=!1,this.loading=!1,this.progress=0,this.image.url=null,this.$el.querySelector('input[type="file"]').value="",!t.response)return this.$buefy.toast.open({duration:5e3,message:t.message,position:"is-top",type:"is-danger"});this.error=t.response.data.errors.file[0]||this.trans("Error")},openCropModal:function(){this.showCropModal=!0},closeCropModal:function(){this.showCropModal=!1},cropThumbnail:function(t){var e=document.createElement("img");e.src=this.image.url;var o=document.createElement("canvas");o.setAttribute("width",t.width),o.setAttribute("height",t.height),o.getContext("2d").drawImage(e,-t.x,-t.y),this.croppedImageUrl=o.toDataURL()},handleLicenseChanged:function(t){this.image.license=t,this.$emit("license-changed",t)}}},g=Object(v.a)(_,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return t.haveImage?o("div",{staticClass:"card"},[o("div",{staticClass:"card-image"},[o("figure",{staticClass:"has-magnifier has-text-centered",on:{click:function(e){t.showModal=!0}}},[o("img",{staticClass:"max-h-36",attrs:{src:t.thumbnailUrl,alt:"Uploaded photo"}}),t._v(" "),o("div",{staticClass:"image-magnifier"},[o("b-icon",{attrs:{icon:"expand",size:"is-medium"}})],1)])]),t._v(" "),t.haveImage?o("footer",{staticClass:"card-footer"},[o("div",{staticClass:"card-footer-item flex-col"},[o("div",{staticClass:"mb-4 w-full flex justify-between"},[t.withCrop?o("button",{staticClass:"button is-outlined is-small mr-2",attrs:{type:"button"},on:{click:t.openCropModal,close:t.closeCropModal}},[o("b-icon",{attrs:{icon:"crop"}})],1):t._e(),t._v(" "),t.image.path||t.hasExisting?o("button",{staticClass:"delete is-danger is-medium",attrs:{type:"button"},on:{click:t.remove}}):t._e()]),t._v(" "),t.withLicense?o("div",{staticClass:"w-full"},[o("b-select",{attrs:{value:t.image.license,expanded:""},on:{input:t.handleLicenseChanged}},[o("option",{domProps:{value:null}},[t._v(t._s(t.trans("labels.field_observations.default")))]),t._v(" "),t._l(t.licenses,(function(e,r){return o("option",{key:r,domProps:{value:r,textContent:t._s(e)}})}))],2)],1):t._e()])]):t._e(),t._v(" "),t.haveImage?o("nz-image-crop-modal",{attrs:{active:t.showCropModal,crop:t.image.crop,"image-url":t.image.url},on:{"update:active":function(e){t.showCropModal=e},"update:crop":function(e){return t.$set(t.image,"crop",e)}}}):t._e(),t._v(" "),t.showModal?o("nz-image-modal",{attrs:{items:[t.thumbnailUrl]},on:{close:function(e){t.showModal=!1}}}):t._e()],1):o("b-field",{attrs:{message:t.error||null,type:t.error?"is-danger":null,expanded:""}},[o("b-upload",{attrs:{"drag-drop":"",expanded:"",disabled:t.uploading||t.loading},on:{input:t.onInput}},[o("section",{ref:"uploadZone",staticClass:"section is-relative"},[o("div",{staticClass:"has-text-centered"},[o("div",[o("b-icon",{attrs:{icon:"upload",size:"is-medium"}})],1),t._v(" "),t.uploading?o("progress",{staticClass:"progress is-primary is-small",attrs:{max:"100"},domProps:{value:t.progress}},[t._v(t._s(t.progress)+"%")]):t.loading?o("div",[t._v(t._s(t.trans("Loading...")))]):o("div",[t._v(t._s(t.text))])])])])],1)}),[],!1,null,null,null);e.a=g.exports},"oCl/":function(t,e,o){var r=o("CH3K"),n=o("LcsW"),a=o("MvSz"),i=o("0ycA"),s=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)r(e,a(t)),t=n(t);return e}:i;t.exports=s},"otv/":function(t,e,o){var r=o("nmnc"),n=r?r.prototype:void 0,a=n?n.valueOf:void 0;t.exports=function(t){return a?Object(a.call(t)):{}}},slQF:function(t,e,o){"use strict";var r={name:"nzImageModal",props:{items:{type:Array,default:function(){return[]}},value:{type:Number,default:0}},data:function(){return{newValue:this.value,active:!1}},computed:{openImage:function(){return this.items[this.newValue]}},watch:{newValue:function(){this.$emit("input",this.newValue)},openImage:{handler:function(t){this.active=Boolean(t)}}},created:function(){document.addEventListener("keyup",this.registerKeyListener)},mounted:function(){this.active=Boolean(this.openImage)},beforeDestroy:function(){document.removeEventListener("keyup",this.registerKeyListener)},methods:{next:function(){var t=this.newValue+1;t>=this.items.length&&(t=0),this.newValue=t},prev:function(){var t=this.newValue-1;t<0&&(t=this.items.length-1),this.newValue=t},registerKeyListener:function(t){var e=t.which||t.keyCode;37===e?this.prev():39===e&&this.next()},onClose:function(t){var e=this;this.active=!1,this.$nextTick((function(){e.$emit("close",t)}))}}},n=o("KHd+"),a=Object(n.a)(r,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("b-modal",{attrs:{active:t.active,"can-cancel":["escape","x"]},on:{"update:active":function(e){t.active=e},close:t.onClose}},[o("div",{staticClass:"image-modal"},[o("img",{attrs:{src:t.openImage}}),t._v(" "),t.items.length>1?o("div",{staticClass:"image-modal-navigation"},[o("div",{staticClass:"image-modal-previous",on:{click:t.prev}},[o("i",{staticClass:"fa fa-chevron-left",attrs:{"aria-hidden":"true"}})]),t._v(" "),o("div",{staticClass:"image-modal-next",on:{click:t.next}},[o("i",{staticClass:"fa fa-chevron-right",attrs:{"aria-hidden":"true"}})])]):t._e()])])}),[],!1,null,null,null);e.a=a.exports},"w/wX":function(t,e,o){var r=o("QqLw"),n=o("ExA7");t.exports=function(t){return n(t)&&"[object Set]"==r(t)}},"wEy/":function(t,e,o){var r=o("ut/Y"),n=o("f5xI");t.exports=function(t,e){var o=[];if(!t||!t.length)return o;var a=-1,i=[],s=t.length;for(e=r(e,3);++a<s;){var l=t[a];e(l,a,t)&&(o.push(l),i.push(a))}return n(t,i),o}},wrZu:function(t,e,o){var r=o("+K+b"),n=o("XYm9"),a=o("b2z7"),i=o("otv/"),s=o("yP5f");t.exports=function(t,e,o){var l=t.constructor;switch(e){case"[object ArrayBuffer]":return r(t);case"[object Boolean]":case"[object Date]":return new l(+t);case"[object DataView]":return n(t,o);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return s(t,o);case"[object Map]":return new l;case"[object Number]":case"[object String]":return new l(t);case"[object RegExp]":return a(t);case"[object Set]":return new l;case"[object Symbol]":return i(t)}}},yHx3:function(t,e){var o=Object.prototype.hasOwnProperty;t.exports=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&o.call(t,"index")&&(r.index=t.index,r.input=t.input),r}},zEVN:function(t,e,o){var r=o("Gi0A"),n=o("sEf8"),a=o("mdPL"),i=a&&a.isMap,s=i?n(i):r;t.exports=s}}]);
//# sourceMappingURL=14.js.map?id=8dbea7feec39d49b333f