(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{KUSn:function(t,e,o){"use strict";var n=o("JkKK"),s=o("WjpJ"),i=o.n(s),a={name:"nzDateInput",props:{label:{type:String,default:"Date"},year:{type:Number,default:Object(n.a)().year()},month:{type:Number,default:Object(n.a)().month()+1},day:{type:Number,default:Object(n.a)().date()},placeholders:{type:Object,default:function(){return{year:"Year",month:"Month",day:"Day"}}},errors:{type:Object,default:function(){return{has:function(){return!1}}}}},computed:{now:function(){return Object(n.a)()},months:function(){if(!this.year||this.year>Object(n.a)().year())return[];var t=this.year===Object(n.a)().year(),e=n.a.months();return t&&e.splice(Object(n.a)().month()+1),e},days:function(){if(!(this.year&&this.month))return[];var t=this.year===Object(n.a)().year()&&this.month-1===Object(n.a)().month(),e=Object(n.a)(new Date(this.year,this.month-1,1)).daysInMonth();return t&&(e=Object(n.a)().date()),i()(1,e+1)}},watch:{year:function(){(this.year>Object(n.a)().year()||this.months.length<this.month-1)&&this.onMonthInput(null),this.truncateDay()},month:function(){this.truncateDay()}},methods:{truncateDay:function(){this.days.length<this.day&&this.onDayInput(null)},onYearInput:function(t){this.$emit("update:year",+t||null)},onMonthInput:function(t){this.$emit("update:month",t)},onDayInput:function(t){this.$emit("update:day",t)}}},r=o("KHd+"),l=Object(r.a)(a,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("b-field",{attrs:{label:t.label}},[o("b-field",{attrs:{expanded:"",grouped:""}},[o("b-field",{attrs:{type:t.errors.has("year")?"is-danger":"",message:t.errors.has("year")?t.errors.first("year"):"",expanded:""}},[o("b-input",{attrs:{placeholder:t.placeholders.year,value:t.year},on:{input:t.onYearInput}})],1),t._v(" "),o("b-field",{attrs:{type:t.errors.has("month")?"is-danger":"",message:t.errors.has("month")?t.errors.first("month"):"",expanded:""}},[o("b-select",{attrs:{placeholder:t.placeholders.month,value:t.month,expanded:""},on:{input:t.onMonthInput}},[o("option",{domProps:{value:null}}),t._v(" "),t._l(t.months,(function(e,n){return o("option",{domProps:{value:n+1,textContent:t._s(e)}})}))],2)],1),t._v(" "),o("b-field",{attrs:{type:t.errors.has("day")?"is-danger":"",message:t.errors.has("day")?t.errors.first("day"):"",expanded:""}},[o("b-select",{attrs:{placeholder:t.placeholders.day,value:t.day,expanded:""},on:{input:t.onDayInput}},[o("option",{domProps:{value:null}}),t._v(" "),t._l(t.days,(function(e){return o("option",{domProps:{value:e,textContent:t._s(e)}})}))],2)],1)],1)],1)}),[],!1,null,null,null);e.a=l.exports},"U++J":function(t,e,o){"use strict";o.r(e);var n=o("5YJQ"),s=o.n(n),i=o("JkKK"),a=o("mwIZ"),r=o.n(a),l=o("J2m7"),u=o.n(l),c=o("ijCd"),d=o.n(c),f=o("WjpJ"),p=o.n(f),h=o("UfWW"),m=o.n(h),b=o("wEy/"),v=o.n(b),g=o("BkRI"),y=o.n(g),_=o("mk2N"),x=o("0XPj"),C=o.n(x);function w(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var S=function(){function t(e){for(var o in function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e)this[o]=e[o]}var e,o,n;return e=t,(o=[{key:"hasRole",value:function(t){return Array.isArray(t)||(t=[t]),!!C()(this.roles.map((function(t){return t.name})),t).length}}])&&w(e.prototype,o),n&&w(e,n),t}(),O={data:function(){return{currentUser:new S(window.App.User)}},computed:{isCuratorOrAdmin:function(){return this.currentUser.hasRole(["admin","curator"])}}},k=o("KUSn"),j=o("nWYc"),P=o("l90O"),I=o("uuKk"),E=o("WYMz");function T(t){return function(t){if(Array.isArray(t))return A(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return A(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return A(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}function $(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function D(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?$(Object(o),!0).forEach((function(e){R(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):$(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function R(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var M={name:"nzFieldObservationForm",mixins:[_.a,O],components:{NzDateInput:k.a,NzPhotoUpload:j.a,NzSpatialInput:P.a,NzTaxonAutocomplete:I.a,NzUserAutocomplete:E.a},props:{observation:{type:Object,default:function(){return{taxon:null,taxon_id:null,taxon_suggestion:"",year:Object(i.a)().year(),month:Object(i.a)().month()+1,day:Object(i.a)().date(),latitude:null,longitude:null,accuracy:null,elevation:null,location:"",photos:[],observer:"",identifier:"",note:"",sex:null,number:null,project:null,habitat:null,found_on:null,stage_id:null,found_dead:!1,found_dead_note:"",data_license:null,image_license:null,time:null,types:[],observed_by_id:null,observed_by:null,identified_by_id:null,identified_by:null,dataset:null,atlas_code:null}}},licenses:{type:Object,default:function(){return{}}},sexes:{type:Object,default:function(){return{}}},observationTypes:{type:Array,default:function(){return[]}},showObserverIdentifier:Boolean,atlasCodes:Array},data:function(){return{keepAfterSubmit:this.getAttributesToKeep(),showMoreDetails:!1,locale:window.App.locale,observationTypeSearch:"",shouldClearType:!1,exifExtracted:!1,lastStageId:null}},computed:{stages:function(){return this.form.taxon?this.form.taxon.stages:[]},time:function(){return this.form.time?Object(i.a)(this.form.time,"HH:mm").toDate():null},selectedObservationTypes:{get:function(){var t=this;return this.observationTypes.filter((function(e){return d()(t.form.observation_types_ids,e.id)}))},set:function(t){this.form.observation_types_ids=t.map((function(t){return t.id}))}},availableObservationTypes:function(){var t=this;return this.observationTypes.filter((function(e){return!d()(t.form.observation_types_ids,e.id)&&e.name.toLowerCase().includes(t.observationTypeSearch.toLowerCase())}))},isIdentified:function(){return!(!this.form.taxon_id&&!this.form.taxon_suggestion)},identificationChanged:function(){return this.form.taxon_id!=this.observation.taxon_id||this.form.taxon_suggestion!=this.observation.taxon_suggestion},usesAtlasCodes:function(){return!!this.form.taxon&&this.form.taxon.uses_atlas_codes}},created:function(){this.setDefaultObservationType()},methods:{newForm:function(){var t=this.observation;return t.photos.forEach((function(t){t.crop=null})),new s.a(D(D({},t),{},{observation_types_ids:t.types.map((function(t){return t.id})),reason:null}),{resetOnSuccess:!1})},hookAfterSubmitWithoutRedirect:function(){this.setDefaultObservationType(),this.clearPhotos(),this.$refs.taxonAutocomplete.focusOnInput()},clearPhotos:function(){var t=this;p()(1,3).forEach((function(e){t.$refs["photoUpload-".concat(e)].clearPhoto()}))},onTaxonSelect:function(t){var e=this;this.form.taxon&&(this.lastStageId=this.form.stage_id),this.form.taxon=t||null,this.form.taxon_id=t?t.id:null,this.form.taxon_suggestion=t?t.name:null;var o=this.lastStageId&&!u()(this.stages,(function(t){return t.id===e.lastStageId}));this.form.stage_id=o?null:this.lastStageId,this.usesAtlasCodes||(this.form.atlas_code=null),this.updateIdentifier()},onTimeInput:function(t){this.form.time=t?Object(i.a)(t).format("HH:mm"):null},onPhotoUploaded:function(t){this.form.photos.push({path:t.path,crop:t.crop,license:t.license});var e=u()(this.availableObservationTypes,{slug:"photographed"});e&&this.pushSelectedObservationType(e),this.promptToExtractExifData(t)},onPhotoRemoved:function(t){v()(this.form.photos,{path:t.path});var e=m()(this.selectedObservationTypes,{slug:"photographed"});if(!this.form.photos.length&&e>=0){var o=this.selectedObservationTypes;o.splice(e,1),this.selectedObservationTypes=o}},onPhotoCropped:function(t){var e=m()(this.form.photos,{path:t.path});if(e>=0){var o=y()(this.form.photos[e]);o.crop=t.crop,this.form.photos.splice(e,1,o)}},getObservationPhotoAttribute:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"url",o=r()(this.observation,"photos.".concat(t,".").concat(e),"");if("url"===e&&o){var n=Object(i.a)(r()(this.observation,"photos.".concat(t,".updated_at"),null));o+=n.isValid()?"?v=".concat(n.format("X")):""}return o},getAttributesToKeep:function(){return["location","accuracy","elevation","latitude","longitude","year","month","day","project","observer","observed_by","observed_by_id","data_license","image_license"]},onTypeTyping:function(t){this.observationTypeSearch=t},onTypeBackspace:function(){this.shouldClearType?(this.form.observation_types_ids.splice(-1,1),this.shouldClearType=!1):this.observationTypeSearch||(this.shouldClearType=!0)},pushSelectedObservationType:function(t){var e=this.selectedObservationTypes;e.push(t),this.selectedObservationTypes=e},promptToExtractExifData:function(t){var e=this;!this.exifExtracted&&t.exif&&this.$buefy.dialog.confirm({message:this.extractExifMessage(t).replace(/\n/g,"<br>"),cancelText:this.trans("No"),confirmText:this.trans("Yes"),onConfirm:function(){e.fillFromExif(t)},onCancel:function(){e.exifExtracted=!0}})},extractExifMessage:function(t){var e=this,o=this.extractExifData(t);return[this.trans("Use data from photo to fill the form?")+"\n"].concat(T(Object.keys(o).map((function(t){return"".concat(e.trans("labels.field_observations."+t),": ").concat(o[t])})))).join("\n")},extractExifData:function(t){var e={};for(var o in t.exif){var n=t.exif[o];n&&(e[o]=n)}return e},fillFromExif:function(t){var e=this.extractExifData(t);for(var o in e)this.form[o]=e[o];this.exifExtracted=!0},onObserverSelect:function(t){this.form.observed_by=t||null,this.form.observed_by_id=t?t.id:null,this.form.observer=t?t.full_name:null},onIdentifierSelect:function(t){this.form.identified_by=t||null,this.form.identified_by_id=t?t.id:null,this.form.identifier=t?t.full_name:null},setDefaultObservationType:function(){this.selectedObservationTypes.length||this.pushSelectedObservationType(u()(this.availableObservationTypes,{slug:"observed"}))},updateIdentifier:function(){var t=this.observation.identified_by;this.identificationChanged&&(t=this.isIdentified?window.App.User:null),this.onIdentifierSelect(t)},onLicenseChanged:function(t,e){var o=y()(this.form.photos[t]);o.license=e,this.form.photos[t]=o}}},L=o("KHd+"),U=Object(L.a)(M,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("form",{staticClass:"field-observation-form",attrs:{action:t.action,method:"POST",lang:t.locale}},[o("div",{staticClass:"columns is-desktop"},[o("div",{staticClass:"column is-half-desktop"},[o("nz-taxon-autocomplete",{ref:"taxonAutocomplete",attrs:{taxon:t.observation.taxon,error:t.form.errors.has("taxon_id"),message:t.form.errors.has("taxon_id")?t.form.errors.first("taxon_id"):null,autofocus:"",label:t.trans("labels.field_observations.taxon"),placeholder:t.trans("labels.field_observations.search_for_taxon")},on:{select:t.onTaxonSelect},model:{value:t.form.taxon_suggestion,callback:function(e){t.$set(t.form,"taxon_suggestion",e)},expression:"form.taxon_suggestion"}}),t._v(" "),o("nz-date-input",{attrs:{year:t.form.year,month:t.form.month,day:t.form.day,errors:t.form.errors,label:t.trans("labels.field_observations.date"),placeholders:{year:t.trans("labels.field_observations.year"),month:t.trans("labels.field_observations.month"),day:t.trans("labels.field_observations.day")}},on:{"update:year":function(e){return t.$set(t.form,"year",e)},"update:month":function(e){return t.$set(t.form,"month",e)},"update:day":function(e){return t.$set(t.form,"day",e)}}}),t._v(" "),o("b-field",{attrs:{label:t.trans("labels.field_observations.photos")}},[o("div",{staticClass:"columns"},[o("div",{staticClass:"column is-one-third"},[o("nz-photo-upload",{ref:"photoUpload-1",attrs:{"image-url":t.getObservationPhotoAttribute(0,"url"),"image-path":t.getObservationPhotoAttribute(0,"path"),"image-license":t.getObservationPhotoAttribute(0,"license"),licenses:t.licenses,text:t.trans("labels.field_observations.upload"),errors:t.form.errors},on:{uploaded:t.onPhotoUploaded,removed:t.onPhotoRemoved,cropped:t.onPhotoCropped,"license-changed":function(e){return t.onLicenseChanged(0,e)}}})],1),t._v(" "),o("div",{staticClass:"column is-one-third"},[o("nz-photo-upload",{ref:"photoUpload-2",attrs:{"image-url":t.getObservationPhotoAttribute(1,"url"),"image-path":t.getObservationPhotoAttribute(1,"path"),"image-license":t.getObservationPhotoAttribute(1,"license"),licenses:t.licenses,text:t.trans("labels.field_observations.upload"),errors:t.form.errors},on:{uploaded:t.onPhotoUploaded,removed:t.onPhotoRemoved,cropped:t.onPhotoCropped,"license-changed":function(e){return t.onLicenseChanged(1,e)}}})],1),t._v(" "),o("div",{staticClass:"column is-one-third"},[o("nz-photo-upload",{ref:"photoUpload-3",attrs:{"image-url":t.getObservationPhotoAttribute(2,"url"),"image-path":t.getObservationPhotoAttribute(2,"path"),"image-license":t.getObservationPhotoAttribute(2,"license"),licenses:t.licenses,text:t.trans("labels.field_observations.upload"),errors:t.form.errors},on:{uploaded:t.onPhotoUploaded,removed:t.onPhotoRemoved,cropped:t.onPhotoCropped,"license-changed":function(e){return t.onLicenseChanged(2,e)}}})],1)])])],1),t._v(" "),o("div",{staticClass:"column is-half-desktop"},[o("nz-spatial-input",{attrs:{latitude:t.form.latitude,longitude:t.form.longitude,location:t.form.location,accuracy:t.form.accuracy,elevation:t.form.elevation,errors:t.form.errors},on:{"update:latitude":function(e){return t.$set(t.form,"latitude",e)},"update:longitude":function(e){return t.$set(t.form,"longitude",e)},"update:location":function(e){return t.$set(t.form,"location",e)},"update:accuracy":function(e){return t.$set(t.form,"accuracy",e)},"update:elevation":function(e){return t.$set(t.form,"elevation",e)}}})],1)]),t._v(" "),o("button",{staticClass:"button is-text",attrs:{type:"button"},on:{click:function(e){t.showMoreDetails=!t.showMoreDetails}}},[t._v("\n    "+t._s(t.showMoreDetails?t.trans("labels.field_observations.less_details"):t.trans("labels.field_observations.more_details"))+"\n  ")]),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.showMoreDetails,expression:"showMoreDetails"}],staticClass:"mt-4"},[o("div",{staticClass:"columns"},[o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.field_observations.stage"),"label-for":"stage",type:t.form.errors.has("stage_id")?"is-danger":null,message:t.form.errors.has("stage_id")?t.form.errors.first("stage_id"):null}},[o("b-select",{attrs:{id:"stage",disabled:!t.stages.length,expanded:""},model:{value:t.form.stage_id,callback:function(e){t.$set(t.form,"stage_id",e)},expression:"form.stage_id"}},[o("option",{domProps:{value:null}},[t._v(t._s(t.trans("labels.field_observations.choose_a_stage")))]),t._v(" "),t._l(t.stages,(function(e){return o("option",{key:e.id,domProps:{value:e.id,textContent:t._s(t.trans("stages."+e.name))}})}))],2)],1)],1),t._v(" "),o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.field_observations.sex"),type:t.form.errors.has("sex")?"is-danger":null,message:t.form.errors.has("sex")?t.form.errors.first("sex"):null}},[o("b-select",{attrs:{expanded:""},model:{value:t.form.sex,callback:function(e){t.$set(t.form,"sex",e)},expression:"form.sex"}},[o("option",{domProps:{value:null}},[t._v(t._s(t.trans("labels.field_observations.choose_a_value")))]),t._v(" "),t._l(t.sexes,(function(e,n){return o("option",{key:n,domProps:{value:n,textContent:t._s(e)}})}))],2)],1)],1)]),t._v(" "),o("b-field",{attrs:{label:t.trans("labels.field_observations.types"),error:t.form.errors.has("observation_types_ids"),message:t.form.errors.has("observation_types_ids")?t.form.errors.first("observation_types_ids"):null}},[o("b-taginput",{attrs:{data:t.availableObservationTypes,autocomplete:"",allowNew:!1,field:"name",icon:"tag",placeholder:t.trans("labels.field_observations.types_placeholder"),"open-on-focus":""},on:{typing:t.onTypeTyping},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onTypeBackspace(e)}},scopedSlots:t._u([{key:"default",fn:function(e){return[o("span",[t._v(t._s(e.option.name))])]}}]),model:{value:t.selectedObservationTypes,callback:function(e){t.selectedObservationTypes=e},expression:"selectedObservationTypes"}})],1),t._v(" "),t.usesAtlasCodes?o("b-field",{attrs:{label:t.trans("labels.field_observations.atlas_code"),"label-for":"atlas-code",type:t.form.errors.has("atlas_code")?"is-danger":null,message:t.form.errors.has("atlas_code")?t.form.errors.first("atlas_code"):null}},[o("b-select",{attrs:{id:"atlas-code",expanded:""},model:{value:t.form.atlas_code,callback:function(e){t.$set(t.form,"atlas_code",e)},expression:"form.atlas_code"}},[o("option",{domProps:{value:null}},[t._v(t._s(t.trans("labels.field_observations.choose_a_value")))]),t._v(" "),t._l(t.atlasCodes,(function(e){return o("option",{key:e.code,domProps:{value:e.code,textContent:t._s(e.name)}})}))],2)],1):t._e(),t._v(" "),o("b-field",{attrs:{label:t.trans("labels.field_observations.number"),"label-for":"number",type:t.form.errors.has("number")?"is-danger":null,message:t.form.errors.has("number")?t.form.errors.first("number"):null}},[o("b-input",{attrs:{id:"number",type:"number"},model:{value:t.form.number,callback:function(e){t.$set(t.form,"number",e)},expression:"form.number"}})],1),t._v(" "),o("b-field",{attrs:{label:t.trans("labels.field_observations.note"),"label-for":"note",error:t.form.errors.has("note"),message:t.form.errors.has("note")?t.form.errors.first("note"):null}},[o("b-input",{attrs:{id:"note",type:"textarea"},model:{value:t.form.note,callback:function(e){t.$set(t.form,"note",e)},expression:"form.note"}})],1),t._v(" "),o("div",{staticClass:"columns"},[o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.field_observations.habitat"),"label-for":"habitat",error:t.form.errors.has("habitat"),message:t.form.errors.has("habitat")?t.form.errors.first("habitat"):null}},[o("b-input",{attrs:{id:"habitat",name:"habitat"},model:{value:t.form.habitat,callback:function(e){t.$set(t.form,"habitat",e)},expression:"form.habitat"}})],1)],1),t._v(" "),o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.literature_observations.found_on"),type:t.form.errors.has("found_on")?"is-danger":null,message:t.form.errors.has("found_on")?t.form.errors.first("found_on"):null}},[o("label",{staticClass:"label",attrs:{slot:"label",for:"found_on"},slot:"label"},[o("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.trans("labels.literature_observations.found_on_tooltip")},expression:"{content: trans('labels.literature_observations.found_on_tooltip')}"}],staticClass:"is-dashed"},[t._v("\n              "+t._s(t.trans("labels.literature_observations.found_on"))+"\n            ")])]),t._v(" "),o("b-input",{attrs:{id:"found_on",name:"found_on"},model:{value:t.form.found_on,callback:function(e){t.$set(t.form,"found_on",e)},expression:"form.found_on"}})],1)],1)]),t._v(" "),o("b-field",{attrs:{label:t.trans("labels.field_observations.time"),"label-for":"time",type:t.form.errors.has("time")?"is-danger":null,message:t.form.errors.has("time")?t.form.errors.first("time"):null}},[o("b-timepicker",{attrs:{id:"time",value:t.time,placeholder:t.trans("labels.field_observations.click_to_select"),icon:"clock-o","mobile-native":!1},on:{input:t.onTimeInput}},[o("button",{staticClass:"button is-danger",attrs:{type:"button"},on:{click:function(e){t.form.time=null}}},[o("b-icon",{attrs:{icon:"close"}})],1)])],1),t._v(" "),o("div",{staticClass:"columns"},[o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.literature_observations.project"),type:t.form.errors.has("project")?"is-danger":null,message:t.form.errors.has("project")?t.form.errors.first("project"):null}},[o("label",{staticClass:"label",attrs:{slot:"label",for:"project"},slot:"label"},[o("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.trans("labels.literature_observations.project_tooltip")},expression:"{content: trans('labels.literature_observations.project_tooltip')}"}],staticClass:"is-dashed"},[t._v("\n              "+t._s(t.trans("labels.literature_observations.project"))+"\n            ")])]),t._v(" "),o("b-input",{attrs:{id:"project",name:"project"},model:{value:t.form.project,callback:function(e){t.$set(t.form,"project",e)},expression:"form.project"}})],1)],1),t._v(" "),o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.field_observations.dataset"),"label-for":"dataset",type:t.form.errors.has("dataset")?"is-danger":null,message:t.form.errors.has("dataset")?t.form.errors.first("dataset"):null}},[o("b-input",{attrs:{id:"dataset",name:"dataset"},model:{value:t.form.dataset,callback:function(e){t.$set(t.form,"dataset",e)},expression:"form.dataset"}})],1)],1)]),t._v(" "),o("b-checkbox",{model:{value:t.form.found_dead,callback:function(e){t.$set(t.form,"found_dead",e)},expression:"form.found_dead"}},[t._v(t._s(t.trans("labels.field_observations.found_dead")))]),t._v(" "),t.form.found_dead?o("b-field",{attrs:{label:t.trans("labels.field_observations.found_dead_note"),"label-for":"found_dead_note",error:t.form.errors.has("found_dead_note"),message:t.form.errors.has("found_dead_note")?t.form.errors.first("found_dead_note"):null}},[o("b-input",{attrs:{id:"found_dead_note",type:"textarea"},model:{value:t.form.found_dead_note,callback:function(e){t.$set(t.form,"found_dead_note",e)},expression:"form.found_dead_note"}})],1):t._e(),t._v(" "),t.showObserverIdentifier?[o("nz-user-autocomplete",{attrs:{error:t.form.errors.has("observer"),message:t.form.errors.has("observer")?t.form.errors.first("observer"):null,user:t.form.observed_by,label:t.trans("labels.field_observations.observer"),placeholder:t.currentUser.full_name},on:{select:t.onObserverSelect},model:{value:t.form.observer,callback:function(e){t.$set(t.form,"observer",e)},expression:"form.observer"}}),t._v(" "),o("nz-user-autocomplete",{attrs:{error:t.form.errors.has("identifier"),message:t.form.errors.has("identifier")?t.form.errors.first("identifier"):null,user:t.form.identified_by,label:t.trans("labels.field_observations.identifier"),disabled:!t.isIdentified},on:{select:t.onIdentifierSelect},model:{value:t.form.identifier,callback:function(e){t.$set(t.form,"identifier",e)},expression:"form.identifier"}})]:t._e(),t._v(" "),o("div",{staticClass:"columns"},[o("div",{staticClass:"column"},[o("b-field",{attrs:{label:t.trans("labels.field_observations.data_license"),"label-for":"data_license",type:t.form.errors.has("data_license")?"is-danger":null,message:t.form.errors.has("data_license")?t.form.errors.first("data_license"):null}},[o("b-select",{attrs:{id:"data_license",expanded:""},model:{value:t.form.data_license,callback:function(e){t.$set(t.form,"data_license",e)},expression:"form.data_license"}},[o("option",{domProps:{value:null}},[t._v(t._s(t.trans("labels.field_observations.default")))]),t._v(" "),t._l(t.licenses,(function(e,n){return o("option",{domProps:{value:n,textContent:t._s(e)}})}))],2)],1)],1)])],2),t._v(" "),o("hr"),t._v(" "),o("button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.trans("labels.field_observations.save_tooltip")},expression:"{content: trans('labels.field_observations.save_tooltip')}"}],staticClass:"button is-primary",class:{"is-loading":t.submittingWithRedirect},attrs:{type:"submit"},on:{click:function(e){return e.preventDefault(),t.submitWithRedirect(e)}}},[t._v("\n    "+t._s(t.trans("buttons.save"))+"\n  ")]),t._v(" "),t.submitMore?o("button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.trans("labels.field_observations.save_more_tooltip")},expression:"{content: trans('labels.field_observations.save_more_tooltip')}"}],staticClass:"button is-primary",class:{"is-outlined":!t.submittingWithoutRedirect,"is-loading":t.submittingWithoutRedirect},attrs:{type:"submit"},on:{click:function(e){return e.preventDefault(),t.submitWithoutRedirect(e)}}},[t._v("\n    "+t._s(t.trans("buttons.save_more"))+"\n  ")]):t._e(),t._v(" "),o("a",{staticClass:"button is-text",attrs:{href:t.cancelUrl},on:{click:t.onCancel}},[t._v(t._s(t.trans("buttons.cancel")))])])}),[],!1,null,null,null);e.default=U.exports},WYMz:function(t,e,o){"use strict";var n=o("vDqi"),s=o.n(n),i=o("sEfC"),a=o.n(i),r=o("mwIZ"),l=o.n(r);function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var c={name:"nzUserAutocomplete",props:{label:{type:String,default:"User"},placeholder:{type:String,default:"Search for user..."},user:{type:Object,default:null},route:{type:String,default:"api.autocomplete.users.index"},value:{type:String,default:""},error:Boolean,message:{type:String,default:null},except:{},autofocus:Boolean,disabled:Boolean},data:function(){return{data:[],selected:this.user||null,loading:!1}},computed:{icon:function(){return this.selected?"check":null}},watch:{user:function(t){this.selected=t}},methods:{fetchData:a()((function(){var t=this;if(this.value){this.data=[],this.loading=!0;var e={name:this.value};this.except&&(e.except=this.except),s.a.get(route(this.route),{params:e}).then((function(e){e.data.data.forEach((function(e){return t.data.push(e)})),t.loading=!1}),(function(e){t.loading=!1}))}}),500),onSelect:function(t){this.selected=t,this.$emit("select",t)},onInput:function(t){var e=this.getValue(this.selected);e&&e!==t&&this.onSelect(null),this.$emit("input",t),this.fetchData()},focusOnInput:function(){this.$el.querySelector("input").focus()},getValue:function(t){if(t)return"object"===u(t)?l()(t,"full_name"):t}}},d=o("KHd+"),f=Object(d.a)(c,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("b-field",{staticClass:"nz-user-autocomplete",attrs:{label:t.label,type:t.error?"is-danger":null,message:t.message}},[o("b-field",{attrs:{grouped:""}},[o("b-autocomplete",{attrs:{value:t.value,data:t.data,field:"full_name",loading:t.loading,icon:t.icon,placeholder:t.placeholder,expanded:"",autofocus:t.autofocus,disabled:t.disabled},on:{input:t.onInput,select:t.onSelect},scopedSlots:t._u([{key:"default",fn:function(e){return[o("div",{staticClass:"media"},[o("div",{staticClass:"media-content"},[t._v("\n            "+t._s(e.option.full_name)+" "),o("small",[t._v("<"+t._s(e.option.email)+">")])])])]}}])})],1)],1)}),[],!1,null,null,null);e.a=f.exports},l90O:function(t,e,o){"use strict";var n=o("sEfC"),s=o.n(n),i={name:"nzSpatialInput",props:{accuracy:Number,elevation:{type:Number,default:100},latitude:{type:Number,default:41},longitude:{type:Number,default:19},location:{type:[String,Number],default:""},errors:{type:Object,default:function(){return{}}},hasOtherErrors:{type:Boolean,default:!1}},data:function(){return{emptyAccuracy:this.calculateEmptyAccuracy(window.App.gmaps.center.zoom),showDetails:!1,elevationService:null,center:window.App.gmaps.center}},computed:{position:function(){return this.coordinatesSet?{lat:this.latitude,lng:this.longitude}:null},coordinatesSet:function(){return!(isNaN(this.latitude)||null===this.latitude||isNaN(this.longitude)||null===this.longitude)},mapHasErrors:function(){return this.hasOtherErrors||this.errors.has("latitude")||this.errors.has("longitude")||this.errors.has("elevation")||this.errors.has("accuracy")||this.errors.has("location")},newAccuracy:function(){return this.accuracy||this.emptyAccuracy},centerCoordinates:function(){return this.position||{lat:this.center.latitude,lng:this.center.longitude}}},watch:{position:function(t){this.coordinatesSet&&this.getElevation(t)}},created:function(){this.setCurrentLocationAsMapCenter()},methods:{castNumber:function(t){return isNaN(t)||""===t?null:Number(t)},onLocationInput:function(t){this.updateLocation(t.target.value)},updateLocation:function(t){this.$emit("update:location",t)},onLongitudeInput:s()((function(t){this.updateLongitude(t.target.value)}),1e3),updateLongitude:function(t){this.$emit("update:longitude",this.castNumber(t))},onLatitudeInput:s()((function(t){this.updateLatitude(t.target.value)}),1e3),updateLatitude:function(t){this.$emit("update:latitude",this.castNumber(t))},onAccuracyInput:s()((function(t){this.updateAccuracy(t.target.value)}),1e3),updateAccuracy:function(t){this.$emit("update:accuracy",this.castNumber(t))},onElevationInput:function(t){this.updateElevation(t.target.value)},updateElevation:function(t){this.$emit("update:elevation",this.castNumber(t))},setMarker:function(t){var e=t.latLng.lat(),o=t.latLng.lng();this.updateLatitude(e),this.updateLongitude(o)},updateRadius:function(t){var e=parseInt(t);null===this.accuracy&&e===this.emptyAccuracy||this.updateAccuracy(e)},getElevation:function(t){var e=this;google&&google.maps&&google.maps.ElevationService&&(this.elevationService||(this.elevationService=new google.maps.ElevationService),this.elevationService.getElevationForLocations({locations:[t]},(function(t,o){if(o==google.maps.ElevationStatus.OK&&t.length){var n=parseInt(t[0].elevation);e.$emit("elevation-fetched",n),e.updateElevation(n)}})))},onZoomChanged:function(t){this.emptyAccuracy=this.calculateEmptyAccuracy(t)},calculateEmptyAccuracy:function(t){return parseInt(6144e3/Math.pow(2,t))},setCurrentLocationAsMapCenter:function(){var t=this;navigator.geolocation&&!this.position&&navigator.geolocation.getCurrentPosition((function(e){t.position||(t.center.latitude=e.coords.latitude,t.center.longitude=e.coords.longitude,t.center.zoom=10)}))}}},a=o("KHd+"),r=Object(a.a)(i,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"spatial-input"},[o("b-field",{staticClass:"is-required",attrs:{label:t.trans("labels.field_observations.map")}},[o("gmap-map",{staticStyle:{width:"100%","min-height":"400px"},attrs:{center:t.centerCoordinates,zoom:t.center.zoom,options:{streetViewControl:!1}},on:{click:t.setMarker,zoom_changed:t.onZoomChanged}},[o("gmap-marker",{attrs:{position:t.position,clickable:!0,draggable:!0},on:{dragend:t.setMarker}}),t._v(" "),t.position&&t.newAccuracy?o("gmap-circle",{attrs:{center:t.position,radius:t.newAccuracy,editable:!0,options:{strokeWeight:.75}},on:{radius_changed:t.updateRadius}}):t._e()],1)],1),t._v(" "),o("div",{staticClass:"has-text-right"},[t.mapHasErrors?o("span",{staticClass:"has-text-danger is-size-7"},[t._v(t._s(t.trans("Some fields have errors")))]):t._e(),t._v(" "),o("button",{staticClass:"button is-white is-small is-text",class:{"has-text-danger":t.mapHasErrors},attrs:{type:"button"},on:{click:function(e){t.showDetails=!t.showDetails}}},[t._v(t._s(t.trans("labels.field_observations.details")))])]),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.showDetails,expression:"showDetails"}]},[o("div",{staticClass:"field is-grouped"},[o("div",{staticClass:"field is-expanded is-required"},[o("label",{staticClass:"label is-small"},[t._v(t._s(t.trans("labels.field_observations.latitude")))]),t._v(" "),o("div",{staticClass:"control is-fullwidth"},[o("input",{staticClass:"input is-small",class:{"is-danger":t.errors.has("latitude")},attrs:{placeholder:"f.e. 42.5234"},domProps:{value:t.latitude},on:{input:t.onLatitudeInput}})]),t._v(" "),t.errors.has("latitude")?o("p",{staticClass:"help is-danger",domProps:{textContent:t._s(t.errors.first("latitude"))}}):t._e()]),t._v(" "),o("div",{staticClass:"field is-expanded is-required"},[o("label",{staticClass:"label is-small"},[t._v(t._s(t.trans("labels.field_observations.longitude")))]),t._v(" "),o("div",{staticClass:"control is-fullwidth"},[o("input",{staticClass:"input is-small",class:{"is-danger":t.errors.has("longitude")},attrs:{placeholder:"f.e. 19.1234"},domProps:{value:t.longitude},on:{input:t.onLongitudeInput}})]),t._v(" "),t.errors.has("longitude")?o("p",{staticClass:"help is-danger",domProps:{textContent:t._s(t.errors.first("longitude"))}}):t._e()])]),t._v(" "),o("div",{staticClass:"field is-grouped"},[o("div",{staticClass:"field is-expanded"},[o("label",{staticClass:"label is-small"},[t._v(t._s(t.trans("labels.field_observations.accuracy_m")))]),t._v(" "),o("div",{staticClass:"control is-fullwidth"},[o("input",{staticClass:"input is-small",attrs:{placeholder:"f.e. 100"},domProps:{value:t.accuracy},on:{input:t.onAccuracyInput}})]),t._v(" "),t.errors.has("accuracy")?o("p",{staticClass:"help is-danger",domProps:{textContent:t._s(t.errors.first("accuracy"))}}):t._e()]),t._v(" "),o("div",{staticClass:"field is-expanded is-required"},[o("label",{staticClass:"label is-small"},[t._v(t._s(t.trans("labels.field_observations.elevation_m")))]),t._v(" "),o("div",{staticClass:"control is-fullwidth"},[o("input",{staticClass:"input is-small",attrs:{placeholder:"f.e. 500"},domProps:{value:t.elevation},on:{input:t.onElevationInput}})]),t._v(" "),t.errors.has("elevation")?o("p",{staticClass:"help is-danger",domProps:{textContent:t._s(t.errors.first("elevation"))}}):t._e()])]),t._v(" "),o("div",{staticClass:"field is-expanded"},[o("label",{staticClass:"label is-small"},[t._v(t._s(t.trans("labels.field_observations.location")))]),t._v(" "),o("div",{staticClass:"control is-fullwidth"},[o("input",{staticClass:"input is-small",class:{"is-danger":t.errors.has("location")},attrs:{placeholder:"Location"},domProps:{value:t.location},on:{input:t.onLocationInput}})]),t._v(" "),t.errors.has("location")?o("p",{staticClass:"help is-danger",domProps:{textContent:t._s(t.errors.first("location"))}}):t._e()]),t._v(" "),t._t("default")],2)],1)}),[],!1,null,null,null);e.a=r.exports},mk2N:function(t,e,o){"use strict";var n=o("5YJQ"),s=o.n(n),i=o("JZM8"),a=o.n(i),r=o("mwIZ"),l=o.n(r),u=o("Y+p1"),c=o.n(u);function d(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function f(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?d(Object(o),!0).forEach((function(e){p(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):d(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function p(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}e.a={name:"nzFieldObservationForm",props:{action:{type:String,required:!0},method:{type:String,default:"POST"},redirectUrl:String,cancelUrl:String,submitMore:Boolean,shouldConfirmSubmit:Boolean,confirmSubmitMessage:{type:String,default:function(){return this.trans("You are about to submit")}},shouldAskReason:Boolean,shouldConfirmCancel:Boolean,submitOnlyDirty:Boolean,submitOnlyDirtyMessage:{type:String,default:function(){return this.trans("There are no changes, the data will not be saved.")}}},data:function(){return{form:this.newForm(),keepAfterSubmit:[],submittingWithRedirect:!1,submittingWithoutRedirect:!1,confirmingSubmit:!1,confirmingCancel:!1,locale:window.App.locale}},created:function(){document.addEventListener("keyup",this.registerKeyListener)},beforeDestroy:function(){document.removeEventListener("keyup",this.registerKeyListener)},methods:{newForm:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new s.a(t,{resetOnSuccess:!1})},registerKeyListener:function(t){var e=13===(t.which||t.keyCode);t.ctrlKey&&t.shiftKey&&e?this.submitMore&&this.submitWithoutRedirect():t.ctrlKey&&e&&this.submitWithRedirect()},confirmSubmit:function(t){var e=this;if(!this.confirmingSubmit){this.confirmingSubmit=!0;var o={message:this.confirmSubmitMessage,confirmText:this.trans("buttons.save"),cancelText:this.trans("buttons.cancel"),onConfirm:t,onCancel:function(){e.confirmingSubmit=!1}};return this.shouldAskReason?this.promptForReason(o):this.$buefy.dialog.confirm(o)}},promptForReason:function(t){var e=this,o=this.$buefy.dialog.prompt(f(f({},t),{},{inputAttrs:{placeholder:this.trans("Reason"),required:!0,maxlength:255}}));return o.$nextTick((function(){o.$refs.input.addEventListener("invalid",(function(t){t.target.setCustomValidity(""),t.target.validity.valid||t.target.setCustomValidity(e.trans("This field is required and can contain max 255 chars."))})),o.$refs.input.addEventListener("input",(function(t){o.validationMessage=null}))})),o},notifyNoChanges:function(){this.$buefy.toast.open({message:this.submitOnlyDirtyMessage,type:"is-info"})},notifyNoChangesAndRedirect:function(){var t=this;this.notifyNoChanges(),setTimeout((function(){t.redirectUrl&&(window.location.href=t.redirectUrl)}),500)},submitWithRedirect:function(){if(!this.form.processing)return this.submitOnlyDirty&&!this.isDirty()?this.notifyNoChangesAndRedirect():this.shouldConfirmSubmit?this.confirmSubmit(this.performSubmitWithRedirect):void this.performSubmitWithRedirect()},performSubmitWithRedirect:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.submittingWithRedirect=!0,this.confirmingSubmit=!1,this.shouldAskReason&&(this.form.reason=t),this.form[this.method.toLowerCase()](this.action).then(this.onSuccessfulSubmitWithRedirect).catch(this.onFailedSubmit)},onSuccessfulSubmitWithRedirect:function(){var t=this;this.form.processing=!0,this.$buefy.toast.open({message:this.trans("Saved successfully"),type:"is-success"}),setTimeout((function(){t.form.processing=!1,t.submittingWithRedirect=!1,t.hookAfterSubmitWithRedirect(),t.redirectUrl&&(window.location.href=t.redirectUrl)}),500)},hookAfterSubmitWithRedirect:function(){},submitWithoutRedirect:function(){if(!this.form.processing)return this.submitOnlyDirty&&!this.isDirty()?this.notifyNoChanges():this.shouldConfirmSubmit?this.confirmSubmit(this.performSubmitWithoutRedirect):void this.performSubmitWithoutRedirect()},performSubmitWithoutRedirect:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.submittingWithoutRedirect=!0,this.confirmingSubmit=!1,this.shouldAskReason&&(this.form.reason=t),this.form[this.method.toLowerCase()](this.action).then(this.onSuccessfulSubmitWithoutRedirect).catch(this.onFailedSubmit)},onSuccessfulSubmitWithoutRedirect:function(){this.submittingWithoutRedirect=!1,this.$buefy.toast.open({message:this.trans("Saved successfully"),type:"is-success"});var t=a()(this.form.data(),this.keepAfterSubmit);this.form.reset(),this.form.populate(t),this.hookAfterSubmitWithoutRedirect()},hookAfterSubmitWithoutRedirect:function(){},onFailedSubmit:function(t){this.submittingWithRedirect=!1,this.submittingWithoutRedirect=!1,this.$buefy.toast.open({duration:2500,message:l()(t,"response.data.message",t.message),type:"is-danger"})},isDirty:function(){return!c()(this.form.data(),this.form.initial)},confirmCancel:function(){var t=this;this.confirmingCancel||(this.confirmingCancel=!0,this.$buefy.dialog.confirm({message:this.trans("If you leave this page changes will not be saved."),onConfirm:function(){t.confirmingCancel=!1,window.location.href=t.cancelUrl},onCancel:function(){t.confirmingCancel=!1},cancelText:this.trans("buttons.stay_on_page"),confirmText:this.trans("buttons.leave_page")}))},onCancel:function(t){this.shouldConfirmCancel&&this.isDirty()&&(t.preventDefault(),this.confirmCancel())}}}},nWYc:function(t,e,o){"use strict";var n=o("+9FD"),s=o.n(n),i=o("dfMu"),a=o.n(i),r=o("T5TR");function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,n=h(t);if(e){var s=h(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return p(this,o)}}function p(t,e){return!e||"object"!==l(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var m=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}(i,t);var e,o,n,s=f(i);function i(){return u(this,i),s.apply(this,arguments)}return e=i,(o=[{key:"setBoxToRealPosition",value:function(t){var e=this.imageEl.naturalWidth,o=this.imageEl.naturalHeight,n=e/this.imageEl.offsetWidth,s=o/this.imageEl.offsetHeight;this.box=new r.a(Math.round(t.x/n),Math.round(t.y/s),Math.round((t.x+t.width)/n),Math.round((t.y+t.height)/s)),this.redraw()}}])&&c(e.prototype,o),n&&c(e,n),i}(a.a),b={name:"nzImageCropModal",mixins:[o("aa4y").a],props:{canCancel:{type:[Array,Boolean],default:function(){return["escape","x"]}},imageUrl:String,crop:Object},data:function(){return{croppr:null,newCrop:this.crop,preserveRatio:!1}},mounted:function(){document.addEventListener("keydown",this.ctrlIsPressed),document.addEventListener("keyup",this.ctrlIsNotPressed)},beforeDestroy:function(){document.removeEventListener("keydown",this.ctrlIsPressed),document.removeEventListener("keyup",this.ctrlIsNotPressed)},watch:{isActive:function(t){var e=this;this.handleScroll(),this.croppr=null,t&&this.$nextTick((function(){e.croppr=new m(e.$refs.cropModalImage,{onCropEnd:function(t){e.newCrop=t},onInitialize:function(t){e.newCrop&&t.setBoxToRealPosition(e.newCrop)}})}))}},methods:{handleScroll:function(){"undefined"!=typeof window&&(this.savedScrollTop=this.savedScrollTop?this.savedScrollTop:document.documentElement.scrollTop,document.body.classList.toggle("is-noscroll",this.isActive),this.isActive?document.body.style.top="-".concat(this.savedScrollTop,"px"):(document.documentElement.scrollTop=this.savedScrollTop,document.body.style.top=null,this.savedScrollTop=null))},cropImage:function(){this.$emit("update:crop",this.newCrop),this.close()},ctrlIsPressed:function(t){17==t.which&&this.croppr&&(this.croppr.options.aspectRatio=this.croppr.box.height()/this.croppr.box.width())},ctrlIsNotPressed:function(t){17==t.which&&this.croppr&&(this.croppr.options.aspectRatio=null)}}},v=o("KHd+"),g={name:"nzPhotoUpload",components:{NzImageCropModal:Object(v.a)(b,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("transition",{attrs:{name:t.animation}},[t.isActive?o("div",{staticClass:"modal is-active"},[o("div",{staticClass:"modal-background"}),t._v(" "),o("div",{staticClass:"animation-content modal-content",style:{maxWidth:t.newWidth}},[o("img",{ref:"cropModalImage",staticClass:"image",attrs:{src:t.imageUrl,alt:"Cropped image"}})]),t._v(" "),o("button",{staticClass:"modal-close is-large",attrs:{type:"button"},on:{click:function(e){return t.cancel("x")}}}),t._v(" "),o("button",{staticClass:"modal-action",attrs:{type:"button"},on:{click:t.cropImage}},[o("b-icon",{attrs:{icon:"check"}})],1)]):t._e()])}),[],!1,null,null,null).exports,NzImageModal:o("slQF").a},props:{imageUrl:{type:String,default:null},imagePath:{type:String,default:null},imageLicense:{type:[Number,String],default:null},licenses:{type:Object,required:!0},text:String,withLicense:{type:Boolean,default:!0},withCrop:{type:Boolean,default:!0}},data:function(){return{image:{url:this.imageUrl,path:this.imagePath,crop:null,license:this.imageLicense},croppedImageUrl:null,reader:null,uploading:!1,progress:0,hasExisting:!!this.imageUrl,error:null,showCropModal:!1,showModal:!1}},watch:{"image.crop":function(t){this.$emit("cropped",this.image),t?this.cropThumbnail(t):this.croppedImageUrl=null}},computed:{haveImage:function(){return!!this.image.url},thumbnailUrl:function(){return this.croppedImageUrl||this.image.url}},methods:{selectImage:function(){this.$refs.input.click()},onInput:function(t){this.error=null,t&&this.upload(t)},upload:function(t){var e=this;return this.uploading=!0,axios.post(route("api.photo-uploads.store"),this.makeForm(t),{headers:{"Content-Type":"multipart/form-data",Accept:"application/json"},onUploadProgress:function(t){e.progress=Math.floor(100*t.loaded/t.total)}}).then((function(o){e.image.path=o.data.file,e.image.exif=o.data.exif,e.image.license=null,e.uploading=!1,e.progress=0,e.$emit("uploaded",e.image),s()(t,(function(t){e.image.url=t.toDataURL()}),{orientation:!0})})).catch(this.handleError)},makeForm:function(t){var e=new FormData;return e.append("file",t),e},remove:function(){var t=this;if(this.hasExisting)return this.hasExisting=!1,this.clearPhoto();axios.delete(route("api.photo-uploads.destroy",this.image.path)).then((function(){t.clearPhoto()}))},clearPhoto:function(){this.$emit("removed",this.image),this.image.path=null,this.image.url=null,this.image.crop=null,this.image.license=null,this.croppedImageUrl=null},handleError:function(t){if(this.uploading=!1,this.progress=0,this.image.url=null,this.$el.querySelector('input[type="file"]').value="",!t.response)return this.$buefy.toast.open({duration:5e3,message:t.message,position:"is-top",type:"is-danger"});this.error=t.response.data.errors.file[0]||this.trans("Error")},openCropModal:function(){this.showCropModal=!0},closeCropModal:function(){this.showCropModal=!1},cropThumbnail:function(t){var e=document.createElement("img");e.src=this.image.url;var o=document.createElement("canvas");o.setAttribute("width",t.width),o.setAttribute("height",t.height),o.getContext("2d").drawImage(e,-t.x,-t.y),this.croppedImageUrl=o.toDataURL()},handleLicenseChanged:function(t){this.image.license=t,this.$emit("license-changed",t)}}},y=Object(v.a)(g,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return t.haveImage?o("div",{staticClass:"card"},[o("div",{staticClass:"card-image"},[o("figure",{staticClass:"has-magnifier has-text-centered",on:{click:function(e){t.showModal=!0}}},[o("img",{staticClass:"max-h-36",attrs:{src:t.thumbnailUrl,alt:"Uploaded photo"}}),t._v(" "),o("div",{staticClass:"image-magnifier"},[o("b-icon",{attrs:{icon:"expand",size:"is-medium"}})],1)])]),t._v(" "),t.haveImage?o("footer",{staticClass:"card-footer"},[o("div",{staticClass:"card-footer-item flex-col"},[o("div",{staticClass:"mb-4 w-full flex justify-between"},[t.withCrop?o("button",{staticClass:"button is-outlined is-small mr-2",attrs:{type:"button"},on:{click:t.openCropModal,close:t.closeCropModal}},[o("b-icon",{attrs:{icon:"crop"}})],1):t._e(),t._v(" "),t.image.path||t.hasExisting?o("button",{staticClass:"delete is-danger is-medium",attrs:{type:"button"},on:{click:t.remove}}):t._e()]),t._v(" "),t.withLicense?o("div",{staticClass:"w-full"},[o("b-select",{attrs:{value:t.image.license,expanded:""},on:{input:t.handleLicenseChanged}},[o("option",{domProps:{value:null}},[t._v(t._s(t.trans("labels.field_observations.default")))]),t._v(" "),t._l(t.licenses,(function(e,n){return o("option",{key:n,domProps:{value:n,textContent:t._s(e)}})}))],2)],1):t._e()])]):t._e(),t._v(" "),t.haveImage?o("nz-image-crop-modal",{attrs:{active:t.showCropModal,crop:t.image.crop,"image-url":t.image.url},on:{"update:active":function(e){t.showCropModal=e},"update:crop":function(e){return t.$set(t.image,"crop",e)}}}):t._e(),t._v(" "),t.showModal?o("nz-image-modal",{attrs:{items:[t.thumbnailUrl]},on:{close:function(e){t.showModal=!1}}}):t._e()],1):o("b-field",{attrs:{message:t.error||null,type:t.error?"is-danger":null,expanded:""}},[o("b-upload",{attrs:{"drag-drop":"",type:"is-fullwidth"},on:{input:t.onInput}},[o("section",{staticClass:"section"},[o("div",{staticClass:"has-text-centered"},[o("div",[o("b-icon",{attrs:{icon:"upload",size:"is-medium"}})],1),t._v(" "),t.uploading?o("progress",{staticClass:"progress is-primary is-small",attrs:{max:"100"},domProps:{value:t.progress}},[t._v(t._s(t.progress)+"%")]):o("div",[t._v(t._s(t.text))])])])])],1)}),[],!1,null,null,null);e.a=y.exports},slQF:function(t,e,o){"use strict";var n={name:"nzImageModal",props:{items:{type:Array,default:function(){return[]}},value:{type:Number,default:0}},data:function(){return{newValue:this.value,active:!1}},computed:{openImage:function(){return this.items[this.newValue]}},watch:{newValue:function(){this.$emit("input",this.newValue)},openImage:{handler:function(t){this.active=Boolean(t)}}},created:function(){document.addEventListener("keyup",this.registerKeyListener)},mounted:function(){this.active=Boolean(this.openImage)},beforeDestroy:function(){document.removeEventListener("keyup",this.registerKeyListener)},methods:{next:function(){var t=this.newValue+1;t>=this.items.length&&(t=0),this.newValue=t},prev:function(){var t=this.newValue-1;t<0&&(t=this.items.length-1),this.newValue=t},registerKeyListener:function(t){var e=t.which||t.keyCode;37===e?this.prev():39===e&&this.next()},onClose:function(t){var e=this;this.active=!1,this.$nextTick((function(){e.$emit("close",t)}))}}},s=o("KHd+"),i=Object(s.a)(n,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("b-modal",{attrs:{active:t.active,"can-cancel":["escape","x"]},on:{"update:active":function(e){t.active=e},close:t.onClose}},[o("div",{staticClass:"image-modal"},[o("img",{attrs:{src:t.openImage}}),t._v(" "),t.items.length>1?o("div",{staticClass:"image-modal-navigation"},[o("div",{staticClass:"image-modal-previous",on:{click:t.prev}},[o("i",{staticClass:"fa fa-chevron-left",attrs:{"aria-hidden":"true"}})]),t._v(" "),o("div",{staticClass:"image-modal-next",on:{click:t.next}},[o("i",{staticClass:"fa fa-chevron-right",attrs:{"aria-hidden":"true"}})])]):t._e()])])}),[],!1,null,null,null);e.a=i.exports},uuKk:function(t,e,o){"use strict";var n=o("vDqi"),s=o.n(n),i=o("sEfC"),a=o.n(i),r=o("mwIZ"),l=o.n(r);function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var c={name:"nzTaxonAutocomplete",props:{label:{type:String,default:"Taxon"},placeholder:{type:String,default:"Search for taxon..."},taxon:{type:Object,default:null},url:{type:String,default:function(){return route("api.taxa.index")}},value:{type:String,default:""},error:Boolean,message:{type:String,default:null},except:{},autofocus:Boolean},data:function(){return{data:[],selected:this.taxon||null,loading:!1}},computed:{haveThumbnail:function(){return this.selected&&this.selected.thumbnail_url},icon:function(){return this.selected?"check":"search"}},watch:{taxon:function(t){this.selected=t}},methods:{fetchData:a()((function(){var t=this;if(this.value){this.data=[],this.loading=!0;var e={name:this.value,limit:20};this.except&&(e.except=this.except),s.a.get(this.url,{params:e}).then((function(e){e.data.data.forEach((function(e){return t.data.push(e)})),t.loading=!1}),(function(e){t.loading=!1}))}}),500),onSelect:function(t){this.selected=t,this.$emit("select",t)},onInput:function(t){var e=this.getValue(this.selected);e&&e!==t&&this.onSelect(null),this.$emit("input",t),this.fetchData()},focusOnInput:function(){this.$el.querySelector("input").focus()},getValue:function(t){if(t)return"object"===u(t)?l()(t,"name"):t},enterPressed:function(){this.$refs.autocomplete.isActive||this.$emit("enter")}}},d=o("KHd+"),f=Object(d.a)(c,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("b-field",{staticClass:"nz-taxon-autocomplete",attrs:{label:t.label,type:t.error?"is-danger":null,message:t.message}},[o("b-field",{attrs:{grouped:""}},[t.haveThumbnail?o("img",{attrs:{width:"32",src:this.selected.thumbnail_url}}):t._e(),t._v(" "),o("b-autocomplete",{ref:"autocomplete",attrs:{value:t.value,data:t.data,field:"name",loading:t.loading,icon:t.icon,placeholder:t.placeholder,expanded:"",autofocus:t.autofocus},on:{input:t.onInput,select:t.onSelect},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.enterPressed(e)}},scopedSlots:t._u([{key:"default",fn:function(e){return[o("div",{staticClass:"media"},[o("div",{staticClass:"media-left"},[e.option.thumbnail_url?o("img",{attrs:{width:"32",src:e.option.thumbnail_url}}):t._e()]),t._v(" "),o("div",{staticClass:"media-content"},[t._v("\n            "+t._s(e.option.name)+t._s(e.option.native_name?" ("+e.option.native_name+")":"")+"\n          ")])])]}}])})],1)],1)}),[],!1,null,null,null);e.a=f.exports}}]);
//# sourceMappingURL=21.js.map?id=6e966d83dbbec376cf70